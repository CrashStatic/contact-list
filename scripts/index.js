var H=document.querySelector("#letter").content.querySelector(".element"),M=({letter:i,id:m})=>{let c=H.cloneNode(!0);return c.querySelector(".element__letter").textContent=i,c.querySelector(".element__letter").dataset.id=m,c.setAttribute("tabindex","0"),c},S=(i,m)=>{let c=document.createDocumentFragment();i.forEach(_=>{let p=M(_);c.append(p)}),m.append(c)};var h=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],x=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];document.addEventListener("DOMContentLoaded",()=>{let i=document.querySelector(".column__left"),m=document.querySelector(".column__right");S(h,i),S(x,m);let c=document.getElementById("name"),_=document.getElementById("position"),p=document.getElementById("phone"),A=document.querySelector(".buttons__button--add"),a=new Map;function $(){let t=localStorage.getItem("contacts");if(t)try{let e=JSON.parse(t);Array.isArray(e)&&e.forEach(({name:o,position:n,phone:r})=>{let s=o[0].toUpperCase(),d=document.querySelector(`[data-id="${s.toLowerCase()}"]`)?.closest(".column__element");d&&q(o,n,r,d)})}catch(e){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",e)}}function y(){let t=Array.from(a.values());localStorage.setItem("contacts",JSON.stringify(t))}function g(t,e,o){return a.has(`${t.toLowerCase()}|${e.toLowerCase()}|${o}`)}let w=(t,e,o)=>{let r=document.querySelector("#message").content.querySelector(".message").cloneNode(!0);return r.querySelector(".message__name").textContent=t,r.querySelector(".message__position").textContent=e,r.querySelector(".message__phone").textContent=o,r};function q(t,e,o,n,r=!0){let s=w(t,e,o);n.querySelector(".element__contacts").append(s),L(n),a.set(`${t.toLowerCase()}|${e.toLowerCase()}|${o}`,{name:t,position:e,phone:o}),r&&y()}A.addEventListener("click",t=>{t.preventDefault();let e=c.value.trim(),o=_.value.trim(),n=p.value.trim();if(!e||!o||!n){alert("\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0432\u0441\u0435 \u043F\u043E\u043B\u044F");return}if(g(e,o,n)){alert("\u042D\u0442\u043E\u0442 \u043A\u043E\u043D\u0442\u0430\u043A\u0442 \u0443\u0436\u0435 \u0437\u0430\u043F\u0438\u0441\u0430\u043D!");return}let r=e[0].toUpperCase(),s=document.querySelector(`[data-id="${r.toLowerCase()}"]`)?.closest(".column__element");q(e,o,n,s),c.value="",_.value="",p.value=""}),document.querySelectorAll(".element__container").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();let n=e.target.closest(".element").querySelector(".element__contacts");n.classList.toggle("element__contacts--open"),n.classList.contains("element__contacts--open")?n.style.maxHeight=`${n.scrollHeight}px`:n.style.maxHeight=0})});function L(t){let e=t.querySelector(".element__counter"),n=t.querySelector(".element__contacts").children.length;n>0?(e.classList.add("element__counter--active"),e.textContent=n):(e.classList.remove("element__counter--active"),e.textContent=0)}let B=t=>{let e=t.target.closest(".message__delete");if(!e)return;let o=e.closest(".element__message"),n=e.closest(".column__element");if(o&&n){let r=o.querySelector(".message__name").textContent,s=o.querySelector(".message__position").textContent,d=o.querySelector(".message__phone").textContent;o.remove(),a.delete(`${r.toLowerCase()}|${s.toLowerCase()}|${d}`),y(),L(n)}};document.addEventListener("click",B);let P=document.querySelector(".buttons__button--clear"),I=()=>{document.querySelectorAll(".column__element").forEach(t=>{let e=t.querySelector(".element__contacts");e.innerHTML="";let o=t.querySelector(".element__counter");o.classList.remove("element__counter--active"),o.textContent="0"}),a.clear(),y()};$();let u=document.querySelector("#edit-popup"),v=u.querySelector(".popup__input--name"),f=u.querySelector(".popup__input--position"),E=u.querySelector(".popup__input--phone"),T=u.querySelector(".popup__button-save"),N=u.querySelector(".popup__button-cancel"),b=document.querySelector(".popup__overlay"),l=null;function k(t){l=t,v.value=t.querySelector(".message__name").textContent,f.value=t.querySelector(".message__position").textContent,E.value=t.querySelector(".message__phone").textContent,u.classList.add("popup--open")}function C(){u.classList.remove("popup--open"),l=null}T.addEventListener("click",()=>{let t=v.value.trim(),e=f.value.trim(),o=E.value.trim();if(!t||!e||!o){alert("\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0432\u0441\u0435 \u043F\u043E\u043B\u044F");return}let n=l.querySelector(".message__name").textContent,r=l.querySelector(".message__position").textContent,s=l.querySelector(".message__phone").textContent;if((t!==n||e!==r||o!==s)&&g(t,e,o)){alert("\u042D\u0442\u043E\u0442 \u043A\u043E\u043D\u0442\u0430\u043A\u0442 \u0443\u0436\u0435 \u0437\u0430\u043F\u0438\u0441\u0430\u043D!");return}a.delete(`${n.toLowerCase()}|${r.toLowerCase()}|${s}`),a.set(`${t.toLowerCase()}|${e.toLowerCase()}|${o}`,{name:t,position:e,phone:o}),l.querySelector(".message__name").textContent=t,l.querySelector(".message__position").textContent=e,l.querySelector(".message__phone").textContent=o,y(),C()}),b.addEventListener("click",C),N.addEventListener("click",C),document.addEventListener("click",t=>{if(t.target.classList.contains("message__edit")){let e=t.target.closest(".message");k(e)}}),P.addEventListener("click",I)});
