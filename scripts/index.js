var L="input--error";function rt(t,e){t.classList.contains(L)||(t.classList.add(L),e.textContent="Fill in all fields!")}function O(t,e){let o=!0;return t.forEach(n=>{$(n,e),n.value.trim()||(rt(n,e),o=!1)}),o}function $(t,e){t.addEventListener("input",()=>{t.classList.remove(L),e.textContent=""})}function N(t,e,o,n){return t.find(r=>r.name.toLowerCase()===e.toLowerCase()&&r.position.toLowerCase()===o.toLowerCase()&&r.phone===n)!==void 0}function M(t){t.textContent="This contact has already been recorded!"}function _(t,e){$(t,e);let o=/[a-zA-Z ]/gmi;return t.value.length<=3?(t.classList.add(L),e.textContent="Value cannot be shorter than 3 letters!",!1):o.test(t.value)?!0:(t.classList.add(L),e.textContent="Value must contain English letters!",!1)}function A(t,e){return $(t,e),/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(t.value)?!0:(t.classList.add(L),e.textContent="Wrong number!",!1)}function I(t,e){let o=e.children.length,n=e.parentElement;o>0?(t.classList.add("element__counter--active"),n.classList.add("element--active"),t.textContent=o):(t.classList.remove("element__counter--active"),n.classList.remove("element--active"),t.textContent=0)}var E=".element__contacts",u=".message__name",d=".message__position",m=".message__phone",P=".element__counter",l=".column__element";var c=[];function J(){let t=localStorage.getItem("contacts");if(t)try{let e=JSON.parse(t);Array.isArray(e)&&e.forEach(({name:o,position:n,phone:r})=>{let s=o[0].toUpperCase(),a=document.querySelector(`[data-id="${s.toLowerCase()}"]`)?.closest(l);a&&b(o,n,r,a)})}catch(e){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",e)}}function S(){localStorage.setItem("contacts",JSON.stringify(c))}var w=t=>{let e="";t.addEventListener("input",()=>{let o=t.value.replace(/\D/g,"");if(o.length<e.length){e=o;return}o.length===1&&o[0]!=="7"&&(o=`7${o}`);let n="+7 ";o.length>1&&(n+=o.substring(1,4)),o.length>4&&(n+=` ${o.substring(4,7)}`),o.length>7&&(n+=` ${o.substring(7,9)}`),o.length>9&&(n+=` ${o.substring(9,11)}`),t.value=n,e=o})};var R=t=>t.key==="Escape";var y=document.querySelector("#edit-popup"),U=y.querySelector("#popup-name"),H=y.querySelector("#popup-position"),T=y.querySelector("#popup-phone"),i=null;function q(t){i=t,U.value=t.querySelector(u).textContent,H.value=t.querySelector(d).textContent,T.value=t.querySelector(m).textContent,y.classList.add("popup--open"),y.querySelector("input").focus(),document.addEventListener("keydown",st)}function k(){if(y.classList.remove("popup--open"),i){let t=i.querySelector(".message__edit");t&&t.focus()}i=null}function ct(){let t=U.value.trim(),e=H.value.trim(),o=T.value,n=i.querySelector(u).textContent,r=i.querySelector(d).textContent,s=i.querySelector(m).textContent,a=[U,H,T],f=document.querySelector(".popup__error");if(w(T),!O(a,f))return;if(N(c,t,e,o)){M(f);return}if(!_(U,f)||!_(H,f)||!A(T,f))return;let p=c.findIndex(v=>v.name===n&&v.position===r&&v.phone===s);p!==-1&&c.splice(p,1),c.push({name:t,position:e,phone:o}),i.querySelector(u).textContent=t,i.querySelector(d).textContent=e,i.querySelector(m).textContent=o;let tt=n[0].toUpperCase(),Z=document.querySelector(`[data-id="${tt.toLowerCase()}"]`)?.closest(l);Z&&Z.querySelector(E).querySelectorAll(".element__message").forEach(C=>{let et=C.querySelector(u).textContent,ot=C.querySelector(d).textContent,nt=C.querySelector(m).textContent;et===n&&ot===r&&nt===s&&(C.querySelector(u).textContent=t,C.querySelector(d).textContent=e,C.querySelector(m).textContent=o)}),S(),k()}document.querySelector(".popup").addEventListener("click",t=>{t.target.matches(".form__button--popup-save")&&ct(),t.target.matches(".popup__overlay")&&k(),t.target.closest(".popup__button-cancel")&&k()});function st(t){R(t)&&(t.preventDefault(),k())}function j(t,e,o){let r=document.querySelector("#message").content.querySelector(".message").cloneNode(!0);return r.querySelector(u).textContent=t,r.querySelector(d).textContent=e,r.querySelector(m).textContent=o,r}function at(t,e){e.innerHTML="",t.forEach(({name:o,position:n,phone:r})=>{let s=j(o,n,r);e.append(s)})}function z(t,e){let o=document.querySelector(`[data-id="${t.toLowerCase()}"]`)?.closest(l);if(o){let n=o.querySelector(E);at(e,n);let r=o.querySelector(P);I(r,n)}}function b(t,e,o,n=!0){c.push({name:t,position:e,phone:o});let r=t[0].toUpperCase(),s=c.filter(a=>a.name[0].toUpperCase()===r);z(r,s),n&&S()}function V(t){let e=t.target.closest(".message"),o=e.querySelector(u).textContent,n=e.querySelector(d).textContent,r=e.querySelector(m).textContent,s=c.findIndex(p=>p.name===o&&p.position===n&&p.phone===r);s!==-1&&c.splice(s,1),e.remove();let a=o[0].toUpperCase(),f=c.filter(p=>p.name[0].toUpperCase()===a);z(a,f),S()}function W(t){if(t.target.closest(l)){let o=t.target.closest(".element").querySelector(E);o.classList.toggle("element__contacts--open"),o.classList.contains("element__contacts--open")?o.style.maxHeight=`${o.scrollHeight}px`:o.style.maxHeight=0}}document.querySelector(".contact-table").addEventListener("click",t=>{if(t.target.closest(".js-delete-contact-button")){V(t);return}if(t.target.closest(".js-edit-contact-button")){let e=t.target.closest(".message");q(e);return}W(t)});document.querySelector(".contact-table").addEventListener("keydown",t=>{if(t.keyCode===32||t.key==="Enter"){if(t.preventDefault(),t.target.matches(".js-delete-contact-button")){V(t);return}if(t.target.matches(".message__edit")){let e=t.target.closest(".message");q(e);return}W(t)}});var g=document.querySelector(".modal"),K=g.querySelector(".modal__input"),x=g.querySelector(".modal__search-area");function lt(t){let e=[];return c.forEach(({name:o,position:n,phone:r})=>{(o.toLowerCase().includes(t)||n.toLowerCase().includes(t)||r.includes(t))&&e.push({name:o,position:n,phone:r})}),e}function Q(t){if(x.innerHTML="",t.length===0){x.textContent="No results found";return}t.forEach(({name:e,position:o,phone:n})=>{let r=j(e,o,n);x.appendChild(r)})}K.addEventListener("input",()=>{let t=K.value.trim().toLowerCase();if(t){let e=lt(t);Q(e)}else x.innerHTML=""});function it(){Q(c)}function G(){g.classList.remove("modal--open"),K.value="",x.innerHTML="",document.querySelector(".body").style.overflow="auto"}document.querySelector(".modal").addEventListener("click",t=>{if(t.target.matches(".modal__button-show")&&it(),t.target.closest(".modal__button-cancel")&&G(),t.target.matches(".modal__overlay")&&G(),t.target.closest(".js-edit-contact-button")){let e=t.target.closest(".message");q(e)}t.target.closest(".js-delete-contact-button")&&V(t)});var B=document.getElementById("name"),D=document.getElementById("position"),h=document.getElementById("phone");function ut(){let t=B.value.trim(),e=D.value.trim(),o=h.value.trim(),n=document.querySelector(".form__error");if(!O([B,D,h],n))return;if(N(c,t,e,o)){M(n);return}if(!_(B,n)||!_(D,n)||!A(h,n))return;let s=t[0].toUpperCase(),a=document.querySelector(`[data-id="${s.toLowerCase()}"]`)?.closest(l);b(t,e,o,a),B.value="",D.value="",h.value=""}function dt(){document.querySelectorAll(l).forEach(t=>{let e=t.querySelector(E);e.innerHTML="";let o=t.querySelector(P);I(o,e)}),c.length=0,S()}function mt(){g.classList.add("modal--open"),document.querySelector(".body").style.overflow="hidden",g.querySelector("input").focus(),document.addEventListener("keydown",pt)}document.querySelector(".form__buttons").addEventListener("click",t=>{t.target.matches(".js-add-contact-button")&&(t.preventDefault(),ut()),t.target.matches(".js-clear-contact-button")&&dt(),t.target.matches(".js-search-contact-button")&&mt()});function pt(t){R(t)&&(t.preventDefault(),G())}var ft=document.querySelector("#letter").content.querySelector(".element"),Et=({letter:t,id:e})=>{let o=ft.cloneNode(!0);return o.querySelector(".element__letter").textContent=t,o.querySelector(".element__letter").dataset.id=e,o.setAttribute("tabindex","0"),o},F=(t,e)=>{let o=document.createDocumentFragment();t.forEach(n=>{let r=Et(n);o.append(r)}),e.append(o)};var X=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],Y=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector(".column-left"),e=document.querySelector(".column-right");F(X,t),F(Y,e),J(),w(h)});
