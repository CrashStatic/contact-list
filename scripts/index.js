var nt=3,st="input--error";function Zt(t,o){t.forEach(e=>{e.classList.remove(st)}),o.textContent=""}function D(t,o,e){t.classList.add(st),o.textContent=e}function Jt(t){let o=[];return t.forEach(e=>{e.value.trim()||o.push({input:e,message:"Fill in all fields!"})}),o}function zt(t,{name:o,position:e,phone:n}){return t.some(r=>r.name?.toLowerCase()===o.toLowerCase()&&r.position?.toLowerCase()===e.toLowerCase()&&r.phone===n)?[{input:null,message:"This contact has already been recorded!"}]:[]}function rt(t,o){let e=[],n=/^[a-zA-Z]+$/;return t.value.length<o&&e.push({input:t,message:`Value cannot be shorter than ${o} letters!`}),n.test(t.value)||e.push({input:t,message:"Value must contain English letters!"}),e}function Qt(t){return/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(t.value)?[]:[{input:t,message:"Wrong number!"}]}function w(t,o,e){let[n,s,r]=t;Zt(t,e);let c=Jt(t);if(c.length>0)return{ok:!1,errors:c};let a={name:n.value,position:s.value,phone:r.value},i=zt(o,a);if(i.length>0)return{ok:!1,errors:i};let p=rt(n,nt);if(p.length>0)return{ok:!1,errors:p};let m=rt(s,nt);if(m.length>0)return{ok:!1,errors:m};let _=Qt(r);return _.length>0?{ok:!1,errors:_}:{ok:!0,errors:[]}}var ct=".body",Y="#letter",at="#message",lt="#search-modal-content",B=".element",j="element--active",it=".element__letter",I=".element__contacts",W="element__contacts--open",b=".element__counter",Z="element__counter--active",Et=".element__message",T=".column__element",C=".message",d=".message__name",L=".message__position",f=".message__phone",J=".contact-table",N=".js-delete-contact-button",g=".js-edit-contact-button",mt=".js-clear-contact-button",ut=".js-search-contact-button",pt="#edit-popup-content",Tt="#popup-name",Ct="#popup-position",dt="#popup-phone",Lt=".popup__error",ft=".modal",_t=".modal__title",St=".modal__body",Mt=".modal__input",z=".modal__search-area",U=".modal__button-show",Ot=".modal__close-button",gt=".modal__overlay",It=".form",ht="name",At="position",Ht="phone",yt=".form__error",Nt=".form__buttons",Rt=".form__button--popup-save";var h=class{constructor(o,e){this.counterElement=o,this.contactsContainer=e,this.count=0}increase(){this.count++,this.update()}decrease(){this.count>0&&(this.count--,this.update())}reset(){this.count=0,this.update()}update(){let o=this.contactsContainer.parentElement;o&&(this.count>0?(this.counterElement.classList.add(Z),o.classList.add(j)):(this.counterElement.classList.remove(Z),o.classList.remove(j))),this.counterElement.textContent=this.count.toString()}};function xt(t){let o=localStorage.getItem(t);if(o)try{return JSON.parse(o)}catch(e){throw console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",e),new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage")}return null}function R(t,o){localStorage.setItem(t,JSON.stringify(o))}var x="contacts",E=xt(x)||[];function u(){return E}function vt({name:t,position:o,phone:e}){let n={name:t,position:o,phone:e};E.push(n),R(x,E)}function Pt({name:t,position:o,phone:e}){E=E.filter(n=>n.name!==t||n.position!==o||n.phone!==e),R(x,E)}function qt(t){return E.filter(({name:o,position:e,phone:n})=>o.toLowerCase().includes(t.toLowerCase())||e.toLowerCase().includes(t.toLowerCase())||n.includes(t))}function Dt(t,o){E=E.map(e=>e.name===t.name&&e.position===t.position&&e.phone===t.phone?o:e),R(x,E)}function wt(){E=[],R(x,E)}var Bt=t=>t.key==="Escape";var l=document.querySelector(ft),bt=document.querySelector(ct);function k(t){l.showModal(),bt.style.overflow="hidden";let o=l.querySelector(St);o.innerHTML="";let e=t.content.cloneNode(!0);o.appendChild(e),l.querySelector("input").focus(),document.addEventListener("keydown",F)}function v(){l.close(),bt.style.overflow="auto",document.removeEventListener("keydown",F)}function F(t){Bt(t)&&(t.preventDefault(),v())}var G=t=>{let o="";t.addEventListener("input",()=>{let e=t.value.replace(/\D/g,"");if(e.length<o.length){o=e;return}e.length===1&&e[0]!=="7"&&(e=`7${e}`);let n="+7 ";e.length>1&&(n+=e.substring(1,4)),e.length>4&&(n+=` ${e.substring(4,7)}`),e.length>7&&(n+=` ${e.substring(7,9)}`),e.length>9&&(n+=` ${e.substring(9,11)}`),t.value=n,o=e})};var Ut=document.querySelector(pt),A,H,O,M=null;function P(t){Ut&&k(Ut);let o=l.querySelector(_t);o&&(o.textContent="Edit contact"),M=t,A=l.querySelector(Tt),H=l.querySelector(Ct),O=l.querySelector(dt),A&&H&&O&&(A.value=t.name,H.value=t.position,O.value=t.phone),l.querySelector("input").focus(),document.addEventListener("keydown",F)}function kt(){let t=A?.value.trim()??"",o=H?.value.trim()??"",e=O?.value??"";if(!M)return;let n=M.name,s=M.position,r=M.phone;if(!A||!H||!O)return;let c=[A,H,O],a=document.querySelector(Lt);O&&G(O);let{ok:i,errors:p}=w(c,u(),a);if(!i){p.forEach(({input:S,message:y})=>{S?D(S,a,y):a.textContent=y});return}let m={name:n,position:s,phone:r},_={name:t,position:o,phone:e};if(Dt(m,_),Ft(m,_),v(),M){let S=document.querySelector(`[data-id="${M.name[0].toUpperCase()}"]`)?.querySelector(C);if(S){let y=S.querySelector(g);y&&y.focus()}}M=null}var V={};function Q({name:t,position:o,phone:e}){let r=document.querySelector(at).content.querySelector(C)?.cloneNode(!0);if(r){let c=r.querySelector(d),a=r.querySelector(L),i=r.querySelector(f);c.textContent=t,a.textContent=o,i.textContent=e}return r}function Xt(t,o){o.innerHTML="",t.forEach(({name:e,position:n,phone:s})=>{let r=Q({name:e,position:n,phone:s});o.append(r)})}function Gt(t,o){let e=document.querySelector(`[data-id="${t.toLowerCase()}"]`)?.closest(T);if(e){let n=e.querySelector(I);Xt(o,n);let s=e.querySelector(b);V[t]||(V[t]=new h(s,n)),V[t].count=o.length,V[t].update()}}function $({name:t,position:o,phone:e},n,s=!0){s&&vt({name:t,position:o,phone:e});let r=n.querySelector("[data-id]")?.textContent?.toUpperCase()??"",c=u().filter(a=>a.name[0].toUpperCase()===r);Gt(r,c)}function K(t){let e=t.target.closest(C);if(!e)return;let n=e.querySelector(d)?.textContent??"",s=e.querySelector(L)?.textContent??"",r=e.querySelector(f)?.textContent??"";Pt({name:n,position:s,phone:r}),e.remove();let c=n[0].toUpperCase(),a=u().filter(i=>i.name[0].toUpperCase()===c);Gt(c,a)}function Ft(t,o){let e=t.name[0].toUpperCase(),n=document.querySelector(`[data-id="${e.toLowerCase()}"]`)?.closest(T);n&&n.querySelector(I).querySelectorAll(Et).forEach(c=>{let a=c.querySelector(d)?.textContent??"",i=c.querySelector(L)?.textContent??"",p=c.querySelector(f)?.textContent??"";if(a===t.name&&i===t.position&&p===t.phone){let m=c.querySelector(d),_=c.querySelector(L),S=c.querySelector(f);m&&_&&S&&(m.textContent=o.name,_.textContent=o.position,S.textContent=o.phone)}})}function Vt(t){let o=t.target;if(o.closest(T)){let e=o.closest(B);if(!e)return;let n=e.querySelector(I);if(!n)return;n.classList.toggle(W),n.classList.contains(W)?n.style.maxHeight=`${n.scrollHeight}px`:n.style.maxHeight="0"}}document.querySelector(J)?.addEventListener("click",t=>{let o=t.target;if(o.closest(N)){K(t);return}if(o.closest(g)){let e=o.closest(C),n=e.querySelector(d)?.textContent??"",s=e.querySelector(L)?.textContent??"",r=e.querySelector(f)?.textContent??"";P({name:n,position:s,phone:r})}Vt(t)});document.querySelector(J)?.addEventListener("keydown",t=>{let o=t;if(o.key===" "||o.key==="Enter"){t.preventDefault();let e=t.target;if(e.matches(N)){K(t);return}if(e.closest(g)){let n=e.closest(C),s=n.querySelector(d)?.textContent??"",r=n.querySelector(L)?.textContent??"",c=n.querySelector(f)?.textContent??"";P({name:s,position:r,phone:c})}Vt(t)}});var te=document.querySelector(lt);function $t(t,o){if(o.innerHTML="",t.length===0){o.textContent="No results found";return}t.forEach(({name:e,position:n,phone:s})=>{let r=Q({name:e,position:n,phone:s});o.appendChild(r)})}function ee(t,o){t.addEventListener("input",()=>{let e=t.value.trim().toLowerCase();if(e){let n=qt(e);$t(n,o)}else o.innerHTML=""})}function Kt(){k(te);let t=l.querySelector(Mt),o=l.querySelector(z);ee(t,o),l.querySelector(U).addEventListener("click",X)}function X(){let t=u(),o=l.querySelector(z);$t(t,o),l.querySelector("input").focus()}var tt=document.getElementById(ht),et=document.getElementById(At),q=document.getElementById(Ht);function oe(){let t=tt.value.trim(),o=et.value.trim(),e=q.value.trim(),n=document.querySelector(yt),s=[tt,et,q],{ok:r,errors:c}=w(s,u(),n);if(!r){c.forEach(({input:p,message:m})=>{p?D(p,n,m):n.textContent=m});return}let a=t[0].toUpperCase(),i=document.querySelector(`[data-id="${a.toLowerCase()}"]`)?.closest(T);$({name:t,position:o,phone:e},i),tt.value="",et.value="",q.value=""}function ne(){document.querySelectorAll(T).forEach(t=>{let o=t.querySelector(I);o.innerHTML="";let e=t.querySelector(b);new h(e,o).reset()}),wt()}var re=document.querySelector(It);re.addEventListener("submit",t=>{t.preventDefault(),oe()});var se=document.querySelector(Nt);se.addEventListener("click",t=>{let o=t.target;o.matches(mt)&&ne(),o.matches(ut)&&Kt()});var Yt=document.querySelector(Y);if(!Yt)throw new Error(`Template with selector ${Y} not found.`);var ce=Yt.content.querySelector(B),ae=({letter:t,id:o})=>{let e=ce?.cloneNode(!0);if(e){let n=e.querySelector(it);n.textContent=t,n.dataset.id=o,e.setAttribute("tabindex","0")}return e},ot=(t,o)=>{let e=document.createDocumentFragment();t.forEach(n=>{let s=ae(n);e.append(s)}),o.append(e)};var jt=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],Wt=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector(".column-left"),o=document.querySelector(".column-right");ot(jt,t),ot(Wt,o),u().forEach(({name:n,position:s,phone:r})=>{let c=n[0].toUpperCase(),a=document.querySelector(`[data-id="${c.toLowerCase()}"]`)?.closest(T);a&&$({name:n,position:s,phone:r},a,!1)}),G(q),l.addEventListener("click",n=>{let s=n.target;if(s.matches(U)&&X(),s.matches(Rt)&&kt(),s.closest(N)){K(n);return}if(s.closest(g)){let r=s.closest(C),c=r.querySelector(d)?.textContent??"",a=r.querySelector(L)?.textContent??"",i=r.querySelector(f)?.textContent??"";P({name:c,position:a,phone:i})}(s.closest(Ot)||s.matches(gt))&&v()})});
