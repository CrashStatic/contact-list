var d="input--error";function K(e,t){e.classList.contains(d)||(e.classList.add(d),t.textContent="Fill in all fields!")}function E(e,t){let o=!0;return e.forEach(n=>{k(n,t),n.value.trim()||(K(n,t),o=!1)}),o}function k(e,t){e.addEventListener("input",()=>{e.classList.remove(d),t.textContent=""})}function v(e,t,o,n){return e.has(`${t.toLowerCase()}|${o.toLowerCase()}|${n}`)}function x(e){e.textContent="This contact has already been recorded!"}function p(e,t){k(e,t);let o=/[a-zA-Z ]/gmi;return e.value.length<=3?(e.classList.add(d),t.textContent="Value cannot be shorter than 3 letters!",!1):o.test(e.value)?!0:(e.classList.add(d),t.textContent="Value must contain English letters!",!1)}function w(e,t){return k(e,t),/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(e.value)?!0:(e.classList.add(d),t.textContent="Wrong number!",!1)}function S(e,t){let o=t.children.length,n=t.parentElement;o>0?(e.classList.add("element__counter--active"),n.classList.add("element--active"),e.textContent=o):(e.classList.remove("element__counter--active"),n.classList.remove("element--active"),e.textContent=0)}var s=new Map;function O(){let e=localStorage.getItem("contacts");if(e)try{let t=JSON.parse(e);Array.isArray(t)&&t.forEach(({name:o,position:n,phone:r})=>{let a=o[0].toUpperCase(),c=document.querySelector(`[data-id="${a.toLowerCase()}"]`)?.closest(".column__element");c&&b(o,n,r,c)})}catch(t){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",t)}}function m(){let e=Array.from(s.values());localStorage.setItem("contacts",JSON.stringify(e))}var P=e=>{let t="";e.addEventListener("input",()=>{let o=e.value.replace(/\D/g,"");if(o.length<t.length){t=o;return}o.length===1&&o[0]!=="7"&&(o=`7${o}`);let n="+7 ";o.length>1&&(n+=o.substring(1,4)),o.length>4&&(n+=` ${o.substring(4,7)}`),o.length>7&&(n+=` ${o.substring(7,9)}`),o.length>9&&(n+=` ${o.substring(9,11)}`),e.value=n,t=o})};var _=document.querySelector("#edit-popup"),I=_.querySelector(".popup__input--name"),$=_.querySelector(".popup__input--position"),h=_.querySelector(".popup__input--phone"),i=null;function y(e){i=e,I.value=e.querySelector(".message__name").textContent,$.value=e.querySelector(".message__position").textContent,h.value=e.querySelector(".message__phone").textContent,_.classList.add("popup--open"),_.querySelector("input").focus()}function H(){if(_.classList.remove("popup--open"),i){let e=i.querySelector(".message__edit");e&&e.focus()}i=null}function Q(){let e=I.value.trim(),t=$.value.trim(),o=h.value,n=i.querySelector(".message__name").textContent,r=i.querySelector(".message__position").textContent,a=i.querySelector(".message__phone").textContent,c=[I,$,h],l=document.querySelector(".popup__error");if(P(h),!E(c,l))return;if(v(s,e,t,o)){x(l);return}if(!p(I,l)||!p($,l)||!w(h,l))return;s.delete(`${n.toLowerCase()}|${r.toLowerCase()}|${a}`),s.set(`${e.toLowerCase()}|${t.toLowerCase()}|${o}`,{name:e,position:t,phone:o}),i.querySelector(".message__name").textContent=e,i.querySelector(".message__position").textContent=t,i.querySelector(".message__phone").textContent=o;let D=n[0].toUpperCase(),q=document.querySelector(`[data-id="${D.toLowerCase()}"]`)?.closest(".column__element");q&&q.querySelector(".element__contacts").querySelectorAll(".element__message").forEach(u=>{let M=u.querySelector(".message__name").textContent,W=u.querySelector(".message__position").textContent,j=u.querySelector(".message__phone").textContent;M===n&&W===r&&j===a&&(u.querySelector(".message__name").textContent=e,u.querySelector(".message__position").textContent=t,u.querySelector(".message__phone").textContent=o)}),m(),H()}document.querySelector(".popup").addEventListener("click",e=>{e.target.matches(".popup__button-save")&&Q(),e.target.matches(".popup__overlay")&&H(),e.target.matches(".popup__button-cancel")&&H()});var V=(e,t,o)=>{let r=document.querySelector("#message").content.querySelector(".message").cloneNode(!0);return r.querySelector(".message__name").textContent=e,r.querySelector(".message__position").textContent=t,r.querySelector(".message__phone").textContent=o,r};function b(e,t,o,n,r=!0){let a=V(e,t,o),c=n.querySelector(".element__contacts");c.append(a);let l=n.querySelector(".element__counter");S(l,c),s.set(`${e.toLowerCase()}|${t.toLowerCase()}|${o}`,{name:e,position:t,phone:o}),r&&m()}function A(e){let t=e.target.closest(".message"),o=t.querySelector(".message__name").textContent,n=t.querySelector(".message__position").textContent,r=t.querySelector(".message__phone").textContent;s.delete(`${o.toLowerCase()}|${n.toLowerCase()}|${r}`),t.remove();let a=o[0].toUpperCase(),c=document.querySelector(`[data-id="${a.toLowerCase()}"]`)?.closest(".column__element");if(c){let l=c.querySelector(".element__contacts");l.querySelectorAll(".element__message").forEach(C=>{let F=C.querySelector(".message__name").textContent,u=C.querySelector(".message__position").textContent,M=C.querySelector(".message__phone").textContent;F===o&&u===n&&M===r&&C.remove()});let q=c.querySelector(".element__counter");S(q,l)}m()}function Z(e){if(e.target.closest(".column__element")){let o=e.target.closest(".element").querySelector(".element__contacts");o.classList.toggle("element__contacts--open"),o.classList.contains("element__contacts--open")?o.style.maxHeight=`${o.scrollHeight}px`:o.style.maxHeight=0}}document.querySelector(".contact-table").addEventListener("click",e=>{if(e.target.matches(".message__delete")){A(e);return}if(e.target.matches(".message__edit")){let t=e.target.closest(".message");y(t);return}Z(e)});document.querySelector(".contact-table").addEventListener("keydown",e=>{if(e.keyCode===32||e.key==="Enter"){if(e.preventDefault(),e.target.matches(".message__delete")){A(e);return}if(e.target.matches(".message__edit")){let t=e.target.closest(".message");y(t);return}Z(e)}});var f=document.querySelector(".modal"),B=f.querySelector(".modal__input"),L=f.querySelector(".modal__search-area");function X(e){let t=[];return s.forEach(({name:o,position:n,phone:r})=>{(o.toLowerCase().includes(e)||n.toLowerCase().includes(e)||r.includes(e))&&t.push({name:o,position:n,phone:r})}),t}function J(e){if(L.innerHTML="",e.length===0){L.textContent="No results found";return}e.forEach(({name:t,position:o,phone:n})=>{let r=V(t,o,n);L.appendChild(r)})}B.addEventListener("input",()=>{let e=B.value.trim().toLowerCase();if(e){let t=X(e);J(t)}else L.innerHTML=""});function Y(){let e=Array.from(s.values());J(e)}function G(){f.classList.remove("modal--open"),B.value="",L.innerHTML="",document.querySelector(".body").style.overflow="auto"}document.querySelector(".modal").addEventListener("click",e=>{if(e.target.matches(".modal__button-show")&&Y(),e.target.matches(".modal__button-cancel")&&G(),e.target.matches(".modal__overlay")&&G(),e.target.matches(".message__edit")){let t=e.target.closest(".message");y(t)}e.target.matches(".message__delete")&&A(e)});var T=document.getElementById("name"),N=document.getElementById("position"),g=document.getElementById("phone");function ee(){let e=T.value.trim(),t=N.value.trim(),o=g.value.trim(),n=document.querySelector(".interaction__error");if(!E([T,N,g],n))return;if(v(s,e,t,o)){x(n);return}if(!p(T,n)||!p(N,n)||!w(g,n))return;let a=e[0].toUpperCase(),c=document.querySelector(`[data-id="${a.toLowerCase()}"]`)?.closest(".column__element");b(e,t,o,c),T.value="",N.value="",g.value=""}function te(){document.querySelectorAll(".column__element").forEach(e=>{let t=e.querySelector(".element__contacts");t.innerHTML="";let o=e.querySelector(".element__counter");S(o,t)}),s.clear(),m()}function oe(){f.classList.add("modal--open"),document.querySelector(".body").style.overflow="hidden",f.querySelector("input").focus()}document.querySelector(".buttons").addEventListener("click",e=>{e.target.matches(".buttons__button--add")&&(e.preventDefault(),ee()),e.target.matches(".buttons__button--clear")&&te(),e.target.matches(".buttons__button--search")&&oe()});var ne=document.querySelector("#letter").content.querySelector(".element"),re=({letter:e,id:t})=>{let o=ne.cloneNode(!0);return o.querySelector(".element__letter").textContent=e,o.querySelector(".element__letter").dataset.id=t,o.setAttribute("tabindex","0"),o},U=(e,t)=>{let o=document.createDocumentFragment();e.forEach(n=>{let r=re(n);o.append(r)}),t.append(o)};var R=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],z=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".column__left"),t=document.querySelector(".column__right");U(R,e),U(z,t),O(),P(g)});
