var ee=document.querySelector("#letter").content.querySelector(".element"),te=({letter:e,id:o})=>{let t=ee.cloneNode(!0);return t.querySelector(".element__letter").textContent=e,t.querySelector(".element__letter").dataset.id=o,t.setAttribute("tabindex","0"),t},U=(e,o)=>{let t=document.createDocumentFragment();e.forEach(n=>{let r=te(n);t.append(r)}),o.append(t)};var z=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],W=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];var h="input--error";function oe(e,o){e.classList.contains(h)||(e.classList.add(h),o.textContent="Fill in all fields!")}function $(e,o){let t=!0;return e.forEach(n=>{D(n,o),n.value.trim()||(oe(n,o),t=!1)}),t}function D(e,o){e.addEventListener("input",()=>{e.classList.remove(h),o.textContent=""})}function b(e,o,t,n){return e.has(`${o.toLowerCase()}|${t.toLowerCase()}|${n}`)}function P(e){e.textContent="This contact has already been recorded!"}function L(e,o){D(e,o);let t=/[a-zA-Z ]/gmi;return e.value.length<=3?(e.classList.add(h),o.textContent="Value cannot be shorter than 3 letters!",!1):t.test(e.value)?!0:(e.classList.add(h),o.textContent="Value must contain English letters!",!1)}function A(e,o){return D(e,o),/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(e.value)?!0:(e.classList.add(h),o.textContent="Wrong number!",!1)}function q(e,o){let t=o.children.length,n=o.parentElement;t>0?(e.classList.add("element__counter--active"),n.classList.add("element--active"),e.textContent=t):(e.classList.remove("element__counter--active"),n.classList.remove("element--active"),e.textContent=0)}var u=new Map;function j(){let e=localStorage.getItem("contacts");if(e)try{let o=JSON.parse(e);Array.isArray(o)&&o.forEach(({name:t,position:n,phone:r})=>{let i=t[0].toUpperCase(),m=document.querySelector(`[data-id="${i.toLowerCase()}"]`)?.closest(".column__element");m&&I(t,n,r,m)})}catch(o){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",o)}}function y(){let e=Array.from(u.values());localStorage.setItem("contacts",JSON.stringify(e))}var T=e=>{let o="";e.addEventListener("input",()=>{let t=e.value.replace(/\D/g,"");if(t.length<o.length){o=t;return}t.length===1&&t[0]!=="7"&&(t=`7${t}`);let n="+7 ";t.length>1&&(n+=t.substring(1,4)),t.length>4&&(n+=` ${t.substring(4,7)}`),t.length>7&&(n+=` ${t.substring(7,9)}`),t.length>9&&(n+=` ${t.substring(9,11)}`),e.value=n,o=t})};var w=document.querySelector("#edit-popup"),k=w.querySelector(".popup__input--name"),N=w.querySelector(".popup__input--position"),x=w.querySelector(".popup__input--phone"),C=null;function O(e){C=e,k.value=e.querySelector(".message__name").textContent,N.value=e.querySelector(".message__position").textContent,x.value=e.querySelector(".message__phone").textContent,w.classList.add("popup--open")}function F(){w.classList.remove("popup--open"),C=null}function ne(){let e=k.value.trim(),o=N.value.trim(),t=x.value,n=C.querySelector(".message__name").textContent,r=C.querySelector(".message__position").textContent,i=C.querySelector(".message__phone").textContent,m=[k,N,x],_=document.querySelector(".popup__error");if(T(x),!$(m,_))return;if(b(u,e,o,t)){P(_);return}if(!L(k,_)||!L(N,_)||!A(x,_))return;u.delete(`${n.toLowerCase()}|${r.toLowerCase()}|${i}`),u.set(`${e.toLowerCase()}|${o.toLowerCase()}|${t}`,{name:e,position:o,phone:t}),C.querySelector(".message__name").textContent=e,C.querySelector(".message__position").textContent=o,C.querySelector(".message__phone").textContent=t;let E=n[0].toUpperCase(),a=document.querySelector(`[data-id="${E.toLowerCase()}"]`)?.closest(".column__element");a&&a.querySelector(".element__contacts").querySelectorAll(".element__message").forEach(p=>{let M=p.querySelector(".message__name").textContent,B=p.querySelector(".message__position").textContent,H=p.querySelector(".message__phone").textContent;M===n&&B===r&&H===i&&(p.querySelector(".message__name").textContent=e,p.querySelector(".message__position").textContent=o,p.querySelector(".message__phone").textContent=t)}),y(),F()}document.addEventListener("click",e=>{e.target.matches(".popup__button-save")&&ne(),e.target.matches(".popup__overlay")&&F(),e.target.matches(".popup__button-cancel")&&F()});var Z=(e,o,t)=>{let r=document.querySelector("#message").content.querySelector(".message").cloneNode(!0);return r.querySelector(".message__name").textContent=e,r.querySelector(".message__position").textContent=o,r.querySelector(".message__phone").textContent=t,r};function I(e,o,t,n,r=!0){let i=Z(e,o,t),m=n.querySelector(".element__contacts");m.append(i);let _=n.querySelector(".element__counter");q(_,m),u.set(`${e.toLowerCase()}|${o.toLowerCase()}|${t}`,{name:e,position:o,phone:t}),r&&y()}function K(){let e=event.target.closest(".message"),o=e.querySelector(".message__name").textContent,t=e.querySelector(".message__position").textContent,n=e.querySelector(".message__phone").textContent;u.delete(`${o.toLowerCase()}|${t.toLowerCase()}|${n}`),e.remove();let r=o[0].toUpperCase(),i=document.querySelector(`[data-id="${r.toLowerCase()}"]`)?.closest(".column__element");if(i){let m=i.querySelector(".element__contacts");m.querySelectorAll(".element__message").forEach(a=>{let S=a.querySelector(".message__name").textContent,g=a.querySelector(".message__position").textContent,p=a.querySelector(".message__phone").textContent;S===o&&g===t&&p===n&&a.remove()});let E=i.querySelector(".element__counter");q(E,m)}e.remove(),y()}function Q(e){if(e.target.closest(".column__element")){let t=e.target.closest(".element").querySelector(".element__contacts");t.classList.toggle("element__contacts--open"),t.classList.contains("element__contacts--open")?t.style.maxHeight=`${t.scrollHeight}px`:t.style.maxHeight=0}}document.querySelector(".contact-table").addEventListener("click",e=>{if(Q(e),e.target.matches(".message__delete")&&K(),e.target.matches(".message__edit")){let o=e.target.closest(".message");O(o)}});document.querySelector(".contact-table").addEventListener("keydown",e=>{if((e.keyCode===32||e.key==="Enter")&&(e.preventDefault(),Q(e),e.target.matches(".message__delete")&&K(),e.target.matches(".message__edit"))){let o=e.target.closest(".message");O(o)}});document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".column__left"),o=document.querySelector(".column__right");U(z,e),U(W,o),j();let t=document.getElementById("name"),n=document.getElementById("position"),r=document.getElementById("phone"),i=document.querySelector(".buttons__button--add");T(r),i.addEventListener("click",s=>{s.preventDefault();let c=t.value.trim(),l=n.value.trim(),f=r.value.trim(),d=document.querySelector(".interaction__error");if(!$([t,n,r],d))return;if(b(u,c,l,f)){P(d);return}if(!L(t,d)||!L(n,d)||!A(r,d))return;let V=c[0].toUpperCase(),v=document.querySelector(`[data-id="${V.toLowerCase()}"]`)?.closest(".column__element");I(c,l,f,v),t.value="",n.value="",r.value=""});let m=document.querySelector(".buttons__button--clear"),_=()=>{document.querySelectorAll(".column__element").forEach(s=>{let c=s.querySelector(".element__contacts");c.innerHTML="";let l=s.querySelector(".element__counter");q(l,c)}),u.clear(),y()};m.addEventListener("click",_);let E=document.querySelector(".buttons__button--search"),a=document.querySelector(".modal"),S=a.querySelector(".modal__input"),g=a.querySelector(".modal__search-area"),p=a.querySelector(".modal__button-cancel"),M=a.querySelector(".modal__overlay"),B=a.querySelector(".modal__button-show");E.addEventListener("click",()=>{a.classList.add("modal--open"),document.querySelector(".body").style.overflow="hidden"});function H(s){let c=[];return u.forEach(({name:l,position:f,phone:d})=>{(l.toLowerCase().includes(s)||f.toLowerCase().includes(s)||d.includes(s))&&c.push({name:l,position:f,phone:d})}),c}function G(s){if(g.innerHTML="",s.length===0){g.textContent="No results found";return}s.forEach(({name:c,position:l,phone:f})=>{let d=Z(c,l,f);g.appendChild(d)})}S.addEventListener("input",()=>{let s=S.value.trim().toLowerCase();if(s){let c=H(s);G(c)}else g.innerHTML=""}),g.addEventListener("click",s=>{let c=s.target.closest(".message__delete");if(c){let l=c.closest(".element__message");if(l){let f=l.querySelector(".message__name").textContent,d=l.querySelector(".message__position").textContent,R=l.querySelector(".message__phone").textContent;u.delete(`${f.toLowerCase()}|${d.toLowerCase()}|${R}`),l.remove();let V=f[0].toUpperCase(),v=document.querySelector(`[data-id="${V.toLowerCase()}"]`)?.closest(".column__element");if(v){let X=v.querySelector(".element__counter"),Y=v.querySelector(".element__contacts");q(X,Y)}}}}),B.addEventListener("click",()=>{let s=Array.from(u.values());G(s)});function J(){a.classList.remove("modal--open"),S.value="",g.innerHTML="",document.querySelector(".body").style.overflow="auto"}p.addEventListener("click",J),M.addEventListener("click",J)});
