var j="input--error";function V(t,e){t.addEventListener("input",()=>{t.classList.remove(j),e.textContent=""})}function x(t,e,o){V(t,e),t.classList.add(j),e.textContent=o}function N(t,e){let o=!0;return t.forEach(n=>{st(n,e)&&(o=!1)}),o}function st(t,e){return t.value.trim()?!1:(x(t,e,"Fill in all fields!"),!0)}function O(t,e,o,n,r){return t.some(c=>c.name.toLowerCase()===e.toLowerCase()&&c.position.toLowerCase()===o.toLowerCase()&&c.phone===n)?(r.textContent="This contact has already been recorded!",!0):!1}function C(t,e){V(t,e);let o=/[a-zA-Z ]/gmi;return t.value.length<=3?(x(t,e,"Value cannot be shorter than 3 letters!"),!1):o.test(t.value)?!0:(x(t,e,"Value must contain English letters!"),!1)}function M(t,e){return V(t,e),/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(t.value)?!0:(x(t,e,"Wrong number!"),!1)}function A(t,e){let o=e.children.length,n=e.parentElement;o>0?(t.classList.add("element__counter--active"),n.classList.add("element--active"),t.textContent=o):(t.classList.remove("element__counter--active"),n.classList.remove("element--active"),t.textContent=0)}var S=".element__contacts",m=".message__name",p=".message__position",f=".message__phone",I=".element__counter",d=".column__element";var $="contacts";function D(){let t=localStorage.getItem($);if(t)try{return JSON.parse(t)}catch(e){return console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",e),[]}return[]}function L(t){localStorage.setItem($,JSON.stringify(t))}var i=D()||[];function u(){return i}function K(t,e,o){let n={name:t,position:e,phone:o};i.push(n),L(i)}function Z(t,e,o){i=i.filter(n=>n.name!==t||n.position!==e||n.phone!==o),L(i)}function F(t){return i.filter(({name:e,position:o,phone:n})=>e.toLowerCase().includes(t.toLowerCase())||o.toLowerCase().includes(t.toLowerCase())||n.includes(t))}function J(t,e){let o=i.findIndex(n=>n.name===t.name&&n.position===t.position&&n.phone===t.phone);o!==-1&&i.splice(o,1),i.push(e),L(i)}function z(){let t=u();t.length=0,L(t)}function G(t,e,o){let r=document.querySelector("#message").content.querySelector(".message").cloneNode(!0);return r.querySelector(m).textContent=t,r.querySelector(p).textContent=e,r.querySelector(f).textContent=o,r}function at(t,e){e.innerHTML="",t.forEach(({name:o,position:n,phone:r})=>{let s=G(o,n,r);e.append(s)})}function W(t,e){let o=document.querySelector(`[data-id="${t.toLowerCase()}"]`)?.closest(d);if(o){let n=o.querySelector(S);at(e,n);let r=o.querySelector(I);A(r,n)}}function b(t,e,o,n,r=!0){r&&K(t,e,o);let s=n.querySelector("[data-id]").textContent.toUpperCase(),c=u().filter(l=>l.name[0].toUpperCase()===s);W(s,c)}function P(t){let e=t.target.closest(".message"),o=e.querySelector(m).textContent,n=e.querySelector(p).textContent,r=e.querySelector(f).textContent;Z(o,n,r),e.remove();let s=o[0].toUpperCase(),c=u().filter(l=>l.name[0].toUpperCase()===s);W(s,c)}function Y(t,e){let o=t.name[0].toUpperCase(),n=document.querySelector(`[data-id="${o.toLowerCase()}"]`)?.closest(d);n&&n.querySelector(S).querySelectorAll(".element__message").forEach(c=>{let l=c.querySelector(m).textContent,v=c.querySelector(p).textContent,T=c.querySelector(f).textContent;l===t.name&&v===t.position&&T===t.phone&&(c.querySelector(m).textContent=e.name,c.querySelector(p).textContent=e.position,c.querySelector(f).textContent=e.phone)})}function Q(t){if(t.target.closest(d)){let o=t.target.closest(".element").querySelector(S);o.classList.toggle("element__contacts--open"),o.classList.contains("element__contacts--open")?o.style.maxHeight=`${o.scrollHeight}px`:o.style.maxHeight=0}}document.querySelector(".contact-table").addEventListener("click",t=>{if(t.target.closest(".js-delete-contact-button")){P(t);return}if(t.target.closest(".js-edit-contact-button")){let e=t.target.closest(".message");w(e);return}Q(t)});document.querySelector(".contact-table").addEventListener("keydown",t=>{if(t.keyCode===32||t.key==="Enter"){if(t.preventDefault(),t.target.matches(".js-delete-contact-button")){P(t);return}if(t.target.matches(".js-edit-contact-button")){let e=t.target.closest(".message");w(e);return}Q(t)}});var R=t=>{let e="";t.addEventListener("input",()=>{let o=t.value.replace(/\D/g,"");if(o.length<e.length){e=o;return}o.length===1&&o[0]!=="7"&&(o=`7${o}`);let n="+7 ";o.length>1&&(n+=o.substring(1,4)),o.length>4&&(n+=` ${o.substring(4,7)}`),o.length>7&&(n+=` ${o.substring(7,9)}`),o.length>9&&(n+=` ${o.substring(9,11)}`),t.value=n,e=o})};var X=t=>t.key==="Escape";var a=document.querySelector(".modal"),lt=document.querySelector("#search-modal-content"),it=document.querySelector("#edit-popup-content"),g,h,_,E=null;function tt(t,e){if(e.innerHTML="",t.length===0){e.textContent="No results found";return}t.forEach(({name:o,position:n,phone:r})=>{let s=G(o,n,r);e.appendChild(s)})}function ut(t,e){t.addEventListener("input",()=>{let o=t.value.trim().toLowerCase();if(o){let n=F(o);tt(n,e)}else e.innerHTML=""})}function et(){ot(lt);let t=a.querySelector(".modal__input"),e=a.querySelector(".modal__search-area");ut(t,e),a.querySelector(".modal__button-show").addEventListener("click",nt)}function ot(t){a.classList.add("modal--open"),document.querySelector(".body").style.overflow="hidden";let e=a.querySelector(".modal__body");e.innerHTML="";let o=t.content.cloneNode(!0);e.appendChild(o),g=a.querySelector("#popup-name"),h=a.querySelector("#popup-position"),_=a.querySelector("#popup-phone"),a.querySelector("input").focus(),document.addEventListener("keydown",k)}function nt(){let t=u(),e=a.querySelector(".modal__search-area");tt(t,e),a.querySelector("input").focus()}function w(t){let e=a.querySelector(".modal__title");e.textContent="Edit contact",E=t,ot(it),g.value=t.querySelector(m).textContent,h.value=t.querySelector(p).textContent,_.value=t.querySelector(f).textContent,a.querySelector("input").focus(),document.addEventListener("keydown",k)}function q(){if(a.classList.remove("modal--open"),document.querySelector(".body").style.overflow="auto",document.removeEventListener("keydown",k),a.removeEventListener("click",mt),E){let t=E.querySelector(".js-edit-contact-button");t&&t.focus()}E=null}function dt(){let t=g.value.trim(),e=h.value.trim(),o=_.value,n=E.querySelector(m).textContent,r=E.querySelector(p).textContent,s=E.querySelector(f).textContent,c=[g,h,_],l=document.querySelector(".popup__error");if(R(_),!N(c,l)||O(u(),t,e,o,l)||!C(g,l)||!C(h,l)||!M(_,l))return;let v={name:n,position:r,phone:s},T={name:t,position:e,phone:o};J(v,T),Y(v,T),q()}document.querySelector(".modal").addEventListener("click",t=>{if(t.target.matches(".modal__button-show")&&nt(),t.target.matches(".form__button--popup-save")&&dt(),t.target.closest(".js-delete-contact-button")){P(t);return}if(t.target.closest(".js-edit-contact-button")){let e=t.target.closest(".message");w(e);return}t.target.closest(".modal__close-button")&&q(),t.target.matches(".modal__overlay")&&q()});function k(t){X(t)&&(t.preventDefault(),q())}function mt(t){(t.target.matches(".modal__overlay")||t.target.closest(".modal__close-button"))&&q()}var H=document.getElementById("name"),U=document.getElementById("position"),y=document.getElementById("phone");function pt(){let t=H.value.trim(),e=U.value.trim(),o=y.value.trim(),n=document.querySelector(".form__error");if(!N([H,U,y],n)||O(u(),t,e,o,n)||!C(H,n)||!C(U,n)||!M(y,n))return;let s=t[0].toUpperCase(),c=document.querySelector(`[data-id="${s.toLowerCase()}"]`)?.closest(d);b(t,e,o,c),H.value="",U.value="",y.value=""}function ft(){document.querySelectorAll(d).forEach(t=>{let e=t.querySelector(S);e.innerHTML="";let o=t.querySelector(I);A(o,e)}),z()}document.querySelector(".form__buttons").addEventListener("click",t=>{t.target.matches(".js-add-contact-button")&&(t.preventDefault(),pt()),t.target.matches(".js-clear-contact-button")&&ft(),t.target.matches(".js-search-contact-button")&&et()});var Et=document.querySelector("#letter").content.querySelector(".element"),Ct=({letter:t,id:e})=>{let o=Et.cloneNode(!0);return o.querySelector(".element__letter").textContent=t,o.querySelector(".element__letter").dataset.id=e,o.setAttribute("tabindex","0"),o},B=(t,e)=>{let o=document.createDocumentFragment();t.forEach(n=>{let r=Ct(n);o.append(r)}),e.append(o)};var rt=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],ct=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector(".column-left"),e=document.querySelector(".column-right");B(rt,t),B(ct,e),u().forEach(({name:n,position:r,phone:s})=>{let c=n[0].toUpperCase(),l=document.querySelector(`[data-id="${c.toLowerCase()}"]`)?.closest(d);l&&b(n,r,s,l,!1)}),R(y)});
