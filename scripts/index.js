var rt="input--error";function Gt(t,e){t.forEach(o=>{o.classList.remove(rt)}),e.textContent=""}function P(t,e,o){t.classList.add(rt),e.textContent=o}function $t(t){let e=[];return t.forEach(o=>{o.value.trim()||e.push({input:o,message:"Fill in all fields!"})}),e}function Vt(t,e,o,n){return t.some(c=>c.name.toLowerCase()===e.toLowerCase()&&c.position.toLowerCase()===o.toLowerCase()&&c.phone===n)?[{input:null,message:"This contact has already been recorded!"}]:[]}function nt(t,e){let o=[],n=/^[a-zA-Z]+$/;return t.value.length<e&&o.push({input:t,message:`Value cannot be shorter than ${e} letters!`}),n.test(t.value)||o.push({input:t,message:"Value must contain English letters!"}),o}function jt(t){return/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(t.value)?[]:[{input:t,message:"Wrong number!"}]}function I(t,e,o){let[n,r,c]=t;Gt(t,o);let s=$t(t);if(s.length>0)return{ok:!1,errors:s};let a=Vt(e,n.value,r.value,c.value);if(a.length>0)return{ok:!1,errors:a};let m=nt(n,3);if(m.length>0)return{ok:!1,errors:m};let u=nt(r,3);if(u.length>0)return{ok:!1,errors:u};let d=jt(c);return d.length>0?{ok:!1,errors:d}:{ok:!0,errors:[]}}var G=".body",ct="#letter",st="#message",at="#search-modal-content",q=".element",$="element--active",V=".element__letter",f=".element__contacts",j="element__contacts--open",v=".element__counter",K="element__counter--active",lt=".element__message",p=".column__element",h=".message",C=".message__name",_=".message__position",T=".message__phone",Y=".contact-table",W=".js-delete-contact-button",M=".js-edit-contact-button",it=".js-clear-contact-button",Et=".js-search-contact-button",ut="#edit-popup-content",pt="#popup-name",mt="#popup-position",dt="#popup-phone",Ct=".popup__error",_t=".modal",Tt=".modal__title",St=".modal__body",ft=".modal__input",Z=".modal__search-area",Lt=".modal__button-show",Ot=".form",ht="name",Mt="position",At="phone",Nt=".form__error",yt=".form__buttons";var L=class{constructor(e,o){this.counterElement=e,this.contactsContainer=o,this.count=0}increase(){this.count++,this.update()}decrease(){this.count>0&&(this.count--,this.update())}reset(){this.count=0,this.update()}update(){let e=this.contactsContainer.parentElement;this.count>0?(this.counterElement.classList.add(K),e.classList.add($)):(this.counterElement.classList.remove(K),e.classList.remove($)),this.counterElement.textContent=this.count}};function gt(t){let e=localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(o){return console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",o),o}}function A(t,e){localStorage.setItem(t,JSON.stringify(e))}var N="contacts",i=gt(N)||[];function E(){return i}function Rt(t,e,o){let n={name:t,position:e,phone:o};i.push(n),A(N,i)}function xt(t,e,o){i=i.filter(n=>n.name!==t||n.position!==e||n.phone!==o),A(N,i)}function Pt(t){return i.filter(({name:e,position:o,phone:n})=>e.toLowerCase().includes(t.toLowerCase())||o.toLowerCase().includes(t.toLowerCase())||n.includes(t))}function It(t,e){i=i.map(o=>o.name===t.name&&o.position===t.position&&o.phone===t.phone?e:o),A(N,i)}function qt(){i=[],A(N,i)}var vt=t=>t.key==="Escape";var l=document.querySelector(_t);function D(t){l.showModal(),document.querySelector(G).style.overflow="hidden";let e=l.querySelector(St);e.innerHTML="";let o=t.content.cloneNode(!0);e.appendChild(o),l.querySelector("input").focus(),document.addEventListener("keydown",w)}function y(){l.close(),document.querySelector(G).style.overflow="auto",document.removeEventListener("keydown",w)}function w(t){vt(t)&&(t.preventDefault(),y())}var U=t=>{let e="";t.addEventListener("input",()=>{let o=t.value.replace(/\D/g,"");if(o.length<e.length){e=o;return}o.length===1&&o[0]!=="7"&&(o=`7${o}`);let n="+7 ";o.length>1&&(n+=o.substring(1,4)),o.length>4&&(n+=` ${o.substring(4,7)}`),o.length>7&&(n+=` ${o.substring(7,9)}`),o.length>9&&(n+=` ${o.substring(9,11)}`),t.value=n,e=o})};var Kt=document.querySelector(ut),B,H,g,S=null;function R(t){D(Kt);let e=l.querySelector(Tt);e.textContent="Edit contact",S=t,B=l.querySelector(pt),H=l.querySelector(mt),g=l.querySelector(dt),B.value=t.querySelector(C).textContent,H.value=t.querySelector(_).textContent,g.value=t.querySelector(T).textContent,l.querySelector("input").focus(),document.addEventListener("keydown",w)}function Dt(){let t=B.value.trim(),e=H.value.trim(),o=g.value,n=S.querySelector(C).textContent,r=S.querySelector(_).textContent,c=S.querySelector(T).textContent,s=[B,H,g],a=document.querySelector(Ct);U(g);let{ok:m,errors:u}=I(s,E(),a);if(!m){u.forEach(({input:O,message:ot})=>{O?P(O,a,ot):a.textContent=ot});return}let d={name:n,position:r,phone:c},et={name:t,position:e,phone:o};if(It(d,et),wt(d,et),y(),S){let O=S.querySelector(M);O&&O.focus()}S=null}var b={};function J(t,e,o){let r=document.querySelector(st).content.querySelector(h).cloneNode(!0);return r.querySelector(C).textContent=t,r.querySelector(_).textContent=e,r.querySelector(T).textContent=o,r}function Yt(t,e){e.innerHTML="",t.forEach(({name:o,position:n,phone:r})=>{let c=J(o,n,r);e.append(c)})}function Ut(t,e){let o=document.querySelector(`[data-id="${t.toLowerCase()}"]`)?.closest(p);if(o){let n=o.querySelector(f);Yt(e,n);let r=o.querySelector(v);b[t]||(b[t]=new L(r,n)),b[t].count=e.length,b[t].update()}}function k(t,e,o,n,r=!0){r&&Rt(t,e,o);let c=n.querySelector("[data-id]").textContent.toUpperCase(),s=E().filter(a=>a.name[0].toUpperCase()===c);Ut(c,s)}function F(t){let e=t.target.closest(h),o=e.querySelector(C).textContent,n=e.querySelector(_).textContent,r=e.querySelector(T).textContent;xt(o,n,r),e.remove();let c=o[0].toUpperCase(),s=E().filter(a=>a.name[0].toUpperCase()===c);Ut(c,s)}function wt(t,e){let o=t.name[0].toUpperCase(),n=document.querySelector(`[data-id="${o.toLowerCase()}"]`)?.closest(p);n&&n.querySelector(f).querySelectorAll(lt).forEach(s=>{let a=s.querySelector(C).textContent,m=s.querySelector(_).textContent,u=s.querySelector(T).textContent;a===t.name&&m===t.position&&u===t.phone&&(s.querySelector(C).textContent=e.name,s.querySelector(_).textContent=e.position,s.querySelector(T).textContent=e.phone)})}function Bt(t){if(t.target.closest(p)){let o=t.target.closest(q).querySelector(f);o.classList.toggle(j),o.classList.contains(j)?o.style.maxHeight=`${o.scrollHeight}px`:o.style.maxHeight=0}}document.querySelector(Y).addEventListener("click",t=>{if(t.target.closest(W)){F(t);return}if(t.target.closest(M)){let e=t.target.closest(h);R(e);return}Bt(t)});document.querySelector(Y).addEventListener("keydown",t=>{if(t.keyCode===32||t.key==="Enter"){if(t.preventDefault(),t.target.matches(W)){F(t);return}if(t.target.matches(M)){let e=t.target.closest(h);R(e);return}Bt(t)}});var Wt=document.querySelector(at);function Ht(t,e){if(e.innerHTML="",t.length===0){e.textContent="No results found";return}t.forEach(({name:o,position:n,phone:r})=>{let c=J(o,n,r);e.appendChild(c)})}function Zt(t,e){t.addEventListener("input",()=>{let o=t.value.trim().toLowerCase();if(o){let n=Pt(o);Ht(n,e)}else e.innerHTML=""})}function bt(){D(Wt);let t=l.querySelector(ft),e=l.querySelector(Z);Zt(t,e),l.querySelector(Lt).addEventListener("click",z)}function z(){let t=E(),e=l.querySelector(Z);Ht(t,e),l.querySelector("input").focus()}var Q=document.getElementById(ht),X=document.getElementById(Mt),x=document.getElementById(At);function Jt(){let t=Q.value.trim(),e=X.value.trim(),o=x.value.trim(),n=document.querySelector(Nt),r=[Q,X,x],{ok:c,errors:s}=I(r,E(),n);if(!c){s.forEach(({input:u,message:d})=>{u?P(u,n,d):n.textContent=d});return}let a=t[0].toUpperCase(),m=document.querySelector(`[data-id="${a.toLowerCase()}"]`)?.closest(p);k(t,e,o,m),Q.value="",X.value="",x.value=""}function zt(){document.querySelectorAll(p).forEach(t=>{let e=t.querySelector(f);e.innerHTML="";let o=t.querySelector(v);new L(o,e).reset()}),qt()}document.querySelector(Ot).addEventListener("submit",t=>{t.preventDefault(),Jt()});document.querySelector(yt).addEventListener("click",t=>{t.target.matches(it)&&zt(),t.target.matches(Et)&&bt()});var Qt=document.querySelector(ct).content.querySelector(q),Xt=({letter:t,id:e})=>{let o=Qt.cloneNode(!0);return o.querySelector(V).textContent=t,o.querySelector(V).dataset.id=e,o.setAttribute("tabindex","0"),o},tt=(t,e)=>{let o=document.createDocumentFragment();t.forEach(n=>{let r=Xt(n);o.append(r)}),e.append(o)};var kt=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],Ft=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector(".column-left"),e=document.querySelector(".column-right");tt(kt,t),tt(Ft,e),E().forEach(({name:n,position:r,phone:c})=>{let s=n[0].toUpperCase(),a=document.querySelector(`[data-id="${s.toLowerCase()}"]`)?.closest(p);a&&k(n,r,c,a,!1)}),U(x),document.querySelector(".modal").addEventListener("click",n=>{if(n.target.matches(".modal__button-show")&&z(),n.target.matches(".form__button--popup-save")&&Dt(),n.target.closest(".js-delete-contact-button")){F(n);return}if(n.target.closest(".js-edit-contact-button")){let r=n.target.closest(".message");R(r);return}(n.target.closest(".modal__close-button")||n.target.matches(".modal__overlay"))&&y()})});
