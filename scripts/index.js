var F="input--error";function at(t,o){t.forEach(e=>{e.classList.remove(F)}),o.textContent=""}function v(t,o,e){t.classList.add(F),o.textContent=e}function lt(t){let o=[];return t.forEach(e=>{e.value.trim()||o.push({input:e,message:"Fill in all fields!"})}),o}function it(t,o,e,n){return t.some(c=>c.name.toLowerCase()===o.toLowerCase()&&c.position.toLowerCase()===e.toLowerCase()&&c.phone===n)?[{input:null,message:"This contact has already been recorded!"}]:[]}function D(t,o){let e=[],n=/^[a-zA-Z]+$/;return t.value.length<o&&e.push({input:t,message:`Value cannot be shorter than ${o} letters!`}),n.test(t.value)||e.push({input:t,message:"Value must contain English letters!"}),e}function ut(t){return/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(t.value)?[]:[{input:t,message:"Wrong number!"}]}function x(t,o,e){let[n,r,c]=t;at(t,e);let s=lt(t);if(s.length>0)return{ok:!1,errors:s};let a=it(o,n.value,r.value,c.value);if(a.length>0)return{ok:!1,errors:a};let p=D(n,3);if(p.length>0)return{ok:!1,errors:p};let d=D(r,3);if(d.length>0)return{ok:!1,errors:d};let f=ut(c);return f.length>0?{ok:!1,errors:f}:{ok:!0,errors:[]}}function M(t,o){let e=o.children.length,n=o.parentElement;e>0?(t.classList.add("element__counter--active"),n.classList.add("element--active"),t.textContent=e):(t.classList.remove("element__counter--active"),n.classList.remove("element--active"),t.textContent=0)}var g=".element__contacts",E=".message__name",C=".message__position",S=".message__phone",N=".element__counter",m=".column__element";function K(t){let o=localStorage.getItem(t);if(o)try{return JSON.parse(o)}catch(e){return console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",e),e}}function h(t,o){localStorage.setItem(t,JSON.stringify(o))}var y="contacts",i=K(y)||[];function u(){return i}function V(t,o,e){let n={name:t,position:o,phone:e};i.push(n),h(y,i)}function Z(t,o,e){i=i.filter(n=>n.name!==t||n.position!==o||n.phone!==e),h(y,i)}function J(t){return i.filter(({name:o,position:e,phone:n})=>o.toLowerCase().includes(t.toLowerCase())||e.toLowerCase().includes(t.toLowerCase())||n.includes(t))}function z(t,o){i=i.map(e=>e.name===t.name&&e.position===t.position&&e.phone===t.phone?o:e),h(y,i)}function W(){i=[],h(y,i)}function R(t,o,e){let r=document.querySelector("#message").content.querySelector(".message").cloneNode(!0);return r.querySelector(E).textContent=t,r.querySelector(C).textContent=o,r.querySelector(S).textContent=e,r}function dt(t,o){o.innerHTML="",t.forEach(({name:e,position:n,phone:r})=>{let c=R(e,n,r);o.append(c)})}function Y(t,o){let e=document.querySelector(`[data-id="${t.toLowerCase()}"]`)?.closest(m);if(e){let n=e.querySelector(g);dt(o,n);let r=e.querySelector(N);M(r,n)}}function O(t,o,e,n,r=!0){r&&V(t,o,e);let c=n.querySelector("[data-id]").textContent.toUpperCase(),s=u().filter(a=>a.name[0].toUpperCase()===c);Y(c,s)}function A(t){let o=t.target.closest(".message"),e=o.querySelector(E).textContent,n=o.querySelector(C).textContent,r=o.querySelector(S).textContent;Z(e,n,r),o.remove();let c=e[0].toUpperCase(),s=u().filter(a=>a.name[0].toUpperCase()===c);Y(c,s)}function Q(t,o){let e=t.name[0].toUpperCase(),n=document.querySelector(`[data-id="${e.toLowerCase()}"]`)?.closest(m);n&&n.querySelector(g).querySelectorAll(".element__message").forEach(s=>{let a=s.querySelector(E).textContent,p=s.querySelector(C).textContent,d=s.querySelector(S).textContent;a===t.name&&p===t.position&&d===t.phone&&(s.querySelector(E).textContent=o.name,s.querySelector(C).textContent=o.position,s.querySelector(S).textContent=o.phone)})}function X(t){if(t.target.closest(m)){let e=t.target.closest(".element").querySelector(g);e.classList.toggle("element__contacts--open"),e.classList.contains("element__contacts--open")?e.style.maxHeight=`${e.scrollHeight}px`:e.style.maxHeight=0}}document.querySelector(".contact-table").addEventListener("click",t=>{if(t.target.closest(".js-delete-contact-button")){A(t);return}if(t.target.closest(".js-edit-contact-button")){let o=t.target.closest(".message");I(o);return}X(t)});document.querySelector(".contact-table").addEventListener("keydown",t=>{if(t.keyCode===32||t.key==="Enter"){if(t.preventDefault(),t.target.matches(".js-delete-contact-button")){A(t);return}if(t.target.matches(".js-edit-contact-button")){let o=t.target.closest(".message");I(o);return}X(t)}});var b=t=>{let o="";t.addEventListener("input",()=>{let e=t.value.replace(/\D/g,"");if(e.length<o.length){o=e;return}e.length===1&&e[0]!=="7"&&(e=`7${e}`);let n="+7 ";e.length>1&&(n+=e.substring(1,4)),e.length>4&&(n+=` ${e.substring(4,7)}`),e.length>7&&(n+=` ${e.substring(7,9)}`),e.length>9&&(n+=` ${e.substring(9,11)}`),t.value=n,o=e})};var tt=t=>t.key==="Escape";var l=document.querySelector(".modal"),mt=document.querySelector("#search-modal-content"),pt=document.querySelector("#edit-popup-content"),w,P,L,_=null;function et(t,o){if(o.innerHTML="",t.length===0){o.textContent="No results found";return}t.forEach(({name:e,position:n,phone:r})=>{let c=R(e,n,r);o.appendChild(c)})}function ft(t,o){t.addEventListener("input",()=>{let e=t.value.trim().toLowerCase();if(e){let n=J(e);et(n,o)}else o.innerHTML=""})}function ot(){nt(mt);let t=l.querySelector(".modal__input"),o=l.querySelector(".modal__search-area");ft(t,o),l.querySelector(".modal__button-show").addEventListener("click",rt)}function nt(t){l.classList.add("modal--open"),document.querySelector(".body").style.overflow="hidden";let o=l.querySelector(".modal__body");o.innerHTML="";let e=t.content.cloneNode(!0);o.appendChild(e),w=l.querySelector("#popup-name"),P=l.querySelector("#popup-position"),L=l.querySelector("#popup-phone"),l.querySelector("input").focus(),document.addEventListener("keydown",k)}function rt(){let t=u(),o=l.querySelector(".modal__search-area");et(t,o),l.querySelector("input").focus()}function I(t){let o=l.querySelector(".modal__title");o.textContent="Edit contact",_=t,nt(pt),w.value=t.querySelector(E).textContent,P.value=t.querySelector(C).textContent,L.value=t.querySelector(S).textContent,l.querySelector("input").focus(),document.addEventListener("keydown",k)}function q(){if(l.classList.remove("modal--open"),document.querySelector(".body").style.overflow="auto",document.removeEventListener("keydown",k),l.removeEventListener("click",Ct),_){let t=_.querySelector(".js-edit-contact-button");t&&t.focus()}_=null}function Et(){let t=w.value.trim(),o=P.value.trim(),e=L.value,n=_.querySelector(E).textContent,r=_.querySelector(C).textContent,c=_.querySelector(S).textContent,s=[w,P,L],a=document.querySelector(".popup__error");b(L);let{ok:p,errors:d}=x(s,u(),a);if(!p){d.forEach(({input:$,message:j})=>{$?v($,a,j):a.textContent=j});return}let f={name:n,position:r,phone:c},B={name:t,position:o,phone:e};z(f,B),Q(f,B),q()}document.querySelector(".modal").addEventListener("click",t=>{if(t.target.matches(".modal__button-show")&&rt(),t.target.matches(".form__button--popup-save")&&Et(),t.target.closest(".js-delete-contact-button")){A(t);return}if(t.target.closest(".js-edit-contact-button")){let o=t.target.closest(".message");I(o);return}t.target.closest(".modal__close-button")&&q(),t.target.matches(".modal__overlay")&&q()});function k(t){tt(t)&&(t.preventDefault(),q())}function Ct(t){(t.target.matches(".modal__overlay")||t.target.closest(".modal__close-button"))&&q()}var H=document.getElementById("name"),U=document.getElementById("position"),T=document.getElementById("phone");function St(){let t=H.value.trim(),o=U.value.trim(),e=T.value.trim(),n=document.querySelector(".form__error"),r=[H,U,T],{ok:c,errors:s}=x(r,u(),n);if(!c){s.forEach(({input:d,message:f})=>{d?v(d,n,f):n.textContent=f});return}let a=t[0].toUpperCase(),p=document.querySelector(`[data-id="${a.toLowerCase()}"]`)?.closest(m);O(t,o,e,p),H.value="",U.value="",T.value=""}function _t(){document.querySelectorAll(m).forEach(t=>{let o=t.querySelector(g);o.innerHTML="";let e=t.querySelector(N);M(e,o)}),W()}document.querySelector(".form__buttons").addEventListener("click",t=>{t.target.matches(".js-add-contact-button")&&(t.preventDefault(),St()),t.target.matches(".js-clear-contact-button")&&_t(),t.target.matches(".js-search-contact-button")&&ot()});var gt=document.querySelector("#letter").content.querySelector(".element"),ht=({letter:t,id:o})=>{let e=gt.cloneNode(!0);return e.querySelector(".element__letter").textContent=t,e.querySelector(".element__letter").dataset.id=o,e.setAttribute("tabindex","0"),e},G=(t,o)=>{let e=document.createDocumentFragment();t.forEach(n=>{let r=ht(n);e.append(r)}),o.append(e)};var ct=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],st=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector(".column-left"),o=document.querySelector(".column-right");G(ct,t),G(st,o),u().forEach(({name:n,position:r,phone:c})=>{let s=n[0].toUpperCase(),a=document.querySelector(`[data-id="${s.toLowerCase()}"]`)?.closest(m);a&&O(n,r,c,a,!1)}),b(T)});
