var ie=document.querySelector("#letter").content.querySelector(".element"),de=({letter:g,id:L})=>{let c=ie.cloneNode(!0);return c.querySelector(".element__letter").textContent=g,c.querySelector(".element__letter").dataset.id=L,c.setAttribute("tabindex","0"),c},N=(g,L)=>{let c=document.createDocumentFragment();g.forEach(C=>{let m=de(C);c.append(m)}),L.append(c)};var U=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],D=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];var me=3,V=11,F=16;document.addEventListener("DOMContentLoaded",()=>{let g=document.querySelector(".column__left"),L=document.querySelector(".column__right");N(U,g),N(D,L);let c=document.getElementById("name"),C=document.getElementById("position"),m=document.getElementById("phone"),G=document.querySelector(".buttons__button--add"),u=new Map;function Z(){let e=localStorage.getItem("contacts");if(e)try{let t=JSON.parse(e);Array.isArray(t)&&t.forEach(({name:o,position:n,phone:s})=>{let r=o[0].toUpperCase(),l=document.querySelector(`[data-id="${r.toLowerCase()}"]`)?.closest(".column__element");l&&k(o,n,s,l)})}catch(t){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",t)}}function q(){let e=Array.from(u.values());localStorage.setItem("contacts",JSON.stringify(e))}function J(e,t,o){return u.has(`${e.toLowerCase()}|${t.toLowerCase()}|${o}`)}let P=(e,t,o)=>{let s=document.querySelector("#message").content.querySelector(".message").cloneNode(!0);return s.querySelector(".message__name").textContent=e,s.querySelector(".message__position").textContent=t,s.querySelector(".message__phone").textContent=o,s};function k(e,t,o,n,s=!0){let r=P(e,t,o);n.querySelector(".element__contacts").append(r),h(n),u.set(`${e.toLowerCase()}|${t.toLowerCase()}|${o}`,{name:e,position:t,phone:o}),s&&q()}G.addEventListener("click",e=>{e.preventDefault();let t=c.value.trim(),o=C.value.trim(),n=m.value.trim();if(!se([c,C,m]))return;if(J(t,o,n)){re();return}if(!O(c)||!O(C)||!ce(m))return;let r=t[0].toUpperCase(),l=document.querySelector(`[data-id="${r.toLowerCase()}"]`)?.closest(".column__element");k(t,o,n,l),c.value="",C.value="",m.value=""}),document.querySelectorAll(".element__container").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();let n=t.target.closest(".element").querySelector(".element__contacts");n.classList.toggle("element__contacts--open"),n.classList.contains("element__contacts--open")?n.style.maxHeight=`${n.scrollHeight}px`:n.style.maxHeight=0})});function h(e){let t=e.querySelector(".element__counter"),n=e.querySelector(".element__contacts").children.length;n>0?(t.classList.add("element__counter--active"),t.textContent=n):(t.classList.remove("element__counter--active"),t.textContent=0)}let R=e=>{let t=e.target.closest(".message__delete");if(!t)return;let o=t.closest(".message"),n=o.querySelector(".message__name").textContent,s=o.querySelector(".message__position").textContent,r=o.querySelector(".message__phone").textContent;if(u.delete(`${n.toLowerCase()}|${s.toLowerCase()}|${r}`),o){o.remove();let l=n[0].toUpperCase(),i=document.querySelector(`[data-id="${l.toLowerCase()}"]`)?.closest(".column__element");i&&(i.querySelector(".element__contacts").querySelectorAll(".element__message").forEach(a=>{let w=a.querySelector(".message__name").textContent,A=a.querySelector(".message__position").textContent,$=a.querySelector(".message__phone").textContent;w===n&&A===s&&$===r&&a.remove()}),h(i)),o.remove(),q()}};document.addEventListener("click",R);let z=document.querySelector(".buttons__button--clear"),K=()=>{document.querySelectorAll(".column__element").forEach(e=>{let t=e.querySelector(".element__contacts");t.innerHTML="",h(e)}),u.clear(),q()};z.addEventListener("click",K),Z();let _=document.querySelector("#edit-popup"),B=_.querySelector(".popup__input--name"),M=_.querySelector(".popup__input--position"),T=_.querySelector(".popup__input--phone"),X=_.querySelector(".popup__button-save"),j=_.querySelector(".popup__button-cancel"),Q=document.querySelector(".popup__overlay"),d=null;function b(e){d=e,B.value=e.querySelector(".message__name").textContent,M.value=e.querySelector(".message__position").textContent,T.value=e.querySelector(".message__phone").textContent,_.classList.add("popup--open")}function E(){_.classList.remove("popup--open"),d=null}X.addEventListener("click",()=>{let e=B.value.trim(),t=M.value.trim(),o=T.value.trim(),n=d.querySelector(".message__name").textContent,s=d.querySelector(".message__position").textContent,r=d.querySelector(".message__phone").textContent;u.delete(`${n.toLowerCase()}|${s.toLowerCase()}|${r}`),u.set(`${e.toLowerCase()}|${t.toLowerCase()}|${o}`,{name:e,position:t,phone:o}),d.querySelector(".message__name").textContent=e,d.querySelector(".message__position").textContent=t,d.querySelector(".message__phone").textContent=o;let l=n[0].toUpperCase(),i=document.querySelector(`[data-id="${l.toLowerCase()}"]`)?.closest(".column__element");i&&i.querySelector(".element__contacts").querySelectorAll(".element__message").forEach(a=>{let w=a.querySelector(".message__name").textContent,A=a.querySelector(".message__position").textContent,$=a.querySelector(".message__phone").textContent;w===n&&A===s&&$===r&&(a.querySelector(".message__name").textContent=e,a.querySelector(".message__position").textContent=t,a.querySelector(".message__phone").textContent=o)}),q(),E()}),Q.addEventListener("click",E),j.addEventListener("click",E),document.addEventListener("click",e=>{if(e.target.classList.contains("message__edit")){let t=e.target.closest(".message");b(t)}});let W=document.querySelector(".buttons__button--search"),p=document.querySelector(".modal"),v=p.querySelector(".modal__input"),y=p.querySelector(".modal__search-area"),Y=p.querySelector(".modal__button-cancel"),ee=p.querySelector(".modal__overlay"),te=p.querySelector(".modal__button-show");W.addEventListener("click",()=>{p.classList.add("modal--open"),document.querySelector(".body").style.overflow="hidden"});function oe(e){let t=[];return u.forEach(({name:o,position:n,phone:s})=>{(o.toLowerCase().includes(e)||n.toLowerCase().includes(e)||s.includes(e))&&t.push({name:o,position:n,phone:s})}),t}function H(e){if(y.innerHTML="",e.length===0){y.textContent="No results found";return}e.forEach(({name:t,position:o,phone:n})=>{let s=P(t,o,n);y.appendChild(s)})}v.addEventListener("input",()=>{let e=v.value.trim().toLowerCase();if(e){let t=oe(e);H(t)}else y.innerHTML=""}),y.addEventListener("click",e=>{let t=e.target.closest(".message__delete");if(t){let o=t.closest(".element__message");if(o){let n=o.querySelector(".message__name").textContent,s=o.querySelector(".message__position").textContent,r=o.querySelector(".message__phone").textContent;u.delete(`${n.toLowerCase()}|${s.toLowerCase()}|${r}`),o.remove();let l=n[0].toUpperCase(),i=document.querySelector(`[data-id="${l.toLowerCase()}"]`)?.closest(".column__element");i&&h(i)}}}),y.addEventListener("click",e=>{let t=e.target.closest(".message__edit");if(t){let o=t.closest(".element__message");o&&b(o)}}),te.addEventListener("click",()=>{let e=Array.from(u.values());H(e)});function I(){p.classList.remove("modal--open"),v.value="",y.innerHTML="",document.querySelector(".body").style.overflow="auto"}Y.addEventListener("click",I),ee.addEventListener("click",I);let S=document.querySelector(".interaction__error"),f="input--error";function ne(e){e.classList.contains(f)||(e.classList.add(f),S.textContent="Fill in all fields!")}function se(e){let t=!0;return e.forEach(o=>{x(o),o.value.trim()||(ne(o),t=!1)}),t}function x(e){e.addEventListener("input",()=>{e.classList.remove(f),S.textContent=""})}function re(){S.textContent="This contact has already been recorded!"}function O(e){x(e);let t=/[a-zA-Z ]/gmi;return e.value.length<=me?(e.classList.add(f),S.textContent="Value cannot be shorter than 3 letters!",!1):t.test(e.value)?!0:(e.classList.add(f),S.textContent="Value must contain English letters!",!1)}function ce(e){return x(e),e.value.length<V||e.value.length>F?(e.classList.add(f),S.textContent=`The length should be from ${V} to ${F} characters!`,!1):!0}function le(e){let t=e.keyCode;return t>=48&&t<=57||t>=96&&t<=109||t===8||t===9||t===187||t===189||t===32||t===37||t===39}m.addEventListener("keydown",e=>{le(e)||e.preventDefault()})});
