var Z="input--error";function B(t,o){t.addEventListener("input",()=>{t.classList.remove(Z),o.textContent=""})}function v(t,o,e){B(t,o),t.classList.add(Z),o.textContent=e}function x(t,o){let e=!0;return t.forEach(n=>{it(n,o)&&(e=!1)}),e}function it(t,o){return t.value.trim()?!1:(v(t,o,"Fill in all fields!"),!0)}function O(t,o,e,n,r){return t.some(s=>s.name.toLowerCase()===o.toLowerCase()&&s.position.toLowerCase()===e.toLowerCase()&&s.phone===n)?(r.textContent="This contact has already been recorded!",!0):!1}function S(t,o){B(t,o);let e=/[a-zA-Z ]/gmi;return t.value.length<=3?(v(t,o,"Value cannot be shorter than 3 letters!"),!1):e.test(t.value)?!0:(v(t,o,"Value must contain English letters!"),!1)}function N(t,o){return B(t,o),/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(t.value)?!0:(v(t,o,"Wrong number!"),!1)}function M(t,o){let e=o.children.length,n=o.parentElement;e>0?(t.classList.add("element__counter--active"),n.classList.add("element--active"),t.textContent=e):(t.classList.remove("element__counter--active"),n.classList.remove("element--active"),t.textContent=0)}var F="contacts";function J(){let t=localStorage.getItem(F);if(t)try{return JSON.parse(t)}catch(o){return console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",o),[]}return[]}function y(t){localStorage.setItem(F,JSON.stringify(t))}var i=J()||[];function l(){return i}function z(t,o,e){let n={name:t,position:o,phone:e};i.push(n),y(i)}function W(t,o,e){i=i.filter(n=>n.name!==t||n.position!==o||n.phone!==e),y(i)}function Y(t){return i.filter(({name:o,position:e,phone:n})=>o.toLowerCase().includes(t.toLowerCase())||e.toLowerCase().includes(t.toLowerCase())||n.includes(t))}function Q(t,o){let e=i.findIndex(n=>n.name===t.name&&n.position===t.position&&n.phone===t.phone);e!==-1&&i.splice(e,1),i.push(o),y(i)}function X(){let t=l();t.length=0,y(t)}var C=".element__contacts",m=".message__name",p=".message__position",f=".message__phone",A=".element__counter",u=".column__element";var I=t=>{let o="";t.addEventListener("input",()=>{let e=t.value.replace(/\D/g,"");if(e.length<o.length){o=e;return}e.length===1&&e[0]!=="7"&&(e=`7${e}`);let n="+7 ";e.length>1&&(n+=e.substring(1,4)),e.length>4&&(n+=` ${e.substring(4,7)}`),e.length>7&&(n+=` ${e.substring(7,9)}`),e.length>9&&(n+=` ${e.substring(9,11)}`),t.value=n,o=e})};var P=t=>t.key==="Escape";var _=document.querySelector("#edit-popup"),w=_.querySelector("#popup-name"),b=_.querySelector("#popup-position"),h=_.querySelector("#popup-phone"),d=null;function T(t){d=t,w.value=t.querySelector(m).textContent,b.value=t.querySelector(p).textContent,h.value=t.querySelector(f).textContent,_.classList.add("popup--open"),_.querySelector("input").focus(),document.addEventListener("keydown",dt)}function R(){if(_.classList.remove("popup--open"),d){let t=d.querySelector(".message__edit");t&&t.focus()}d=null}function ut(){let t=w.value.trim(),o=b.value.trim(),e=h.value,n=d.querySelector(m).textContent,r=d.querySelector(p).textContent,c=d.querySelector(f).textContent,s=[w,b,h],a=document.querySelector(".popup__error");if(I(h),!x(s,a)||O(l(),t,o,e,a)||!S(w,a)||!S(b,a)||!N(h,a))return;Q({name:n,position:r,phone:c},{name:t,position:o,phone:e}),d.querySelector(m).textContent=t,d.querySelector(p).textContent=o,d.querySelector(f).textContent=e;let ct=n[0].toUpperCase(),K=document.querySelector(`[data-id="${ct.toLowerCase()}"]`)?.closest(u);K&&K.querySelector(C).querySelectorAll(".element__message").forEach(E=>{let st=E.querySelector(m).textContent,at=E.querySelector(p).textContent,lt=E.querySelector(f).textContent;st===n&&at===r&&lt===c&&(E.querySelector(m).textContent=t,E.querySelector(p).textContent=o,E.querySelector(f).textContent=e)}),R()}document.querySelector(".popup").addEventListener("click",t=>{t.target.matches(".form__button--popup-save")&&ut(),t.target.matches(".popup__overlay")&&R(),t.target.closest(".popup__button-cancel")&&R()});function dt(t){P(t)&&(t.preventDefault(),R())}function $(t,o,e){let r=document.querySelector("#message").content.querySelector(".message").cloneNode(!0);return r.querySelector(m).textContent=t,r.querySelector(p).textContent=o,r.querySelector(f).textContent=e,r}function mt(t,o){o.innerHTML="",t.forEach(({name:e,position:n,phone:r})=>{let c=$(e,n,r);o.append(c)})}function tt(t,o){let e=document.querySelector(`[data-id="${t.toLowerCase()}"]`)?.closest(u);if(e){let n=e.querySelector(C);mt(o,n);let r=e.querySelector(A);M(r,n)}}function U(t,o,e,n,r=!0){r&&z(t,o,e);let c=n.querySelector("[data-id]").textContent.toUpperCase(),s=l().filter(a=>a.name[0].toUpperCase()===c);tt(c,s)}function H(t){let o=t.target.closest(".message"),e=o.querySelector(m).textContent,n=o.querySelector(p).textContent,r=o.querySelector(f).textContent;W(e,n,r),o.remove();let c=e[0].toUpperCase(),s=l().filter(a=>a.name[0].toUpperCase()===c);tt(c,s)}function et(t){if(t.target.closest(u)){let e=t.target.closest(".element").querySelector(C);e.classList.toggle("element__contacts--open"),e.classList.contains("element__contacts--open")?e.style.maxHeight=`${e.scrollHeight}px`:e.style.maxHeight=0}}document.querySelector(".contact-table").addEventListener("click",t=>{if(t.target.closest(".js-delete-contact-button")){H(t);return}if(t.target.closest(".js-edit-contact-button")){let o=t.target.closest(".message");T(o);return}et(t)});document.querySelector(".contact-table").addEventListener("keydown",t=>{if(t.keyCode===32||t.key==="Enter"){if(t.preventDefault(),t.target.matches(".js-delete-contact-button")){H(t);return}if(t.target.matches(".message__edit")){let o=t.target.closest(".message");T(o);return}et(t)}});var L=document.querySelector(".modal"),D=L.querySelector(".modal__input"),q=L.querySelector(".modal__search-area");function ot(t){if(q.innerHTML="",t.length===0){q.textContent="No results found";return}t.forEach(({name:o,position:e,phone:n})=>{let r=$(o,e,n);q.appendChild(r)})}D.addEventListener("input",()=>{let t=D.value.trim().toLowerCase();if(t){let o=Y(t);ot(o)}else q.innerHTML=""});function pt(){let t=l();ot(t)}function V(){L.classList.remove("modal--open"),D.value="",q.innerHTML="",document.querySelector(".body").style.overflow="auto"}document.querySelector(".modal").addEventListener("click",t=>{if(t.target.matches(".modal__button-show")&&pt(),t.target.closest(".modal__button-cancel")&&V(),t.target.matches(".modal__overlay")&&V(),t.target.closest(".js-edit-contact-button")){let o=t.target.closest(".message");T(o)}t.target.closest(".js-delete-contact-button")&&H(t)});var G=document.getElementById("name"),k=document.getElementById("position"),g=document.getElementById("phone");function ft(){let t=G.value.trim(),o=k.value.trim(),e=g.value.trim(),n=document.querySelector(".form__error");if(!x([G,k,g],n)||O(l(),t,o,e,n)||!S(G,n)||!S(k,n)||!N(g,n))return;let c=t[0].toUpperCase(),s=document.querySelector(`[data-id="${c.toLowerCase()}"]`)?.closest(u);U(t,o,e,s),G.value="",k.value="",g.value=""}function Ct(){document.querySelectorAll(u).forEach(t=>{let o=t.querySelector(C);o.innerHTML="";let e=t.querySelector(A);M(e,o)}),X()}function Et(){L.classList.add("modal--open"),document.querySelector(".body").style.overflow="hidden",L.querySelector("input").focus(),document.addEventListener("keydown",St)}document.querySelector(".form__buttons").addEventListener("click",t=>{t.target.matches(".js-add-contact-button")&&(t.preventDefault(),ft()),t.target.matches(".js-clear-contact-button")&&Ct(),t.target.matches(".js-search-contact-button")&&Et()});function St(t){P(t)&&(t.preventDefault(),V())}var _t=document.querySelector("#letter").content.querySelector(".element"),Lt=({letter:t,id:o})=>{let e=_t.cloneNode(!0);return e.querySelector(".element__letter").textContent=t,e.querySelector(".element__letter").dataset.id=o,e.setAttribute("tabindex","0"),e},j=(t,o)=>{let e=document.createDocumentFragment();t.forEach(n=>{let r=Lt(n);e.append(r)}),o.append(e)};var nt=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],rt=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector(".column-left"),o=document.querySelector(".column-right");j(nt,t),j(rt,o),l().forEach(({name:n,position:r,phone:c})=>{let s=n[0].toUpperCase(),a=document.querySelector(`[data-id="${s.toLowerCase()}"]`)?.closest(u);a&&U(n,r,c,a,!1)}),I(g)});
