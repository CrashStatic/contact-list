function y(e,o){let t=o.children.length,n=o.parentElement;t>0?(e.classList.add("element__counter--active"),n.classList.add("element--active"),e.textContent=t):(e.classList.remove("element__counter--active"),n.classList.remove("element--active"),e.textContent=0)}var c=new Map;function F(){let e=localStorage.getItem("contacts");if(e)try{let o=JSON.parse(e);Array.isArray(o)&&o.forEach(({name:t,position:n,phone:r})=>{let i=t[0].toUpperCase(),a=document.querySelector(`[data-id="${i.toLowerCase()}"]`)?.closest(".column__element");a&&x(t,n,r,a)})}catch(o){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",o)}}function _(){let e=Array.from(c.values());localStorage.setItem("contacts",JSON.stringify(e))}var w=e=>{let o="";e.addEventListener("input",()=>{let t=e.value.replace(/\D/g,"");if(t.length<o.length){o=t;return}t.length===1&&t[0]!=="7"&&(t=`7${t}`);let n="+7 ";t.length>1&&(n+=t.substring(1,4)),t.length>4&&(n+=` ${t.substring(4,7)}`),t.length>7&&(n+=` ${t.substring(7,9)}`),t.length>9&&(n+=` ${t.substring(9,11)}`),e.value=n,o=t})};var f="input--error";function z(e,o){e.classList.contains(f)||(e.classList.add(f),o.textContent="Fill in all fields!")}function P(e,o){let t=!0;return e.forEach(n=>{B(n,o),n.value.trim()||(z(n,o),t=!1)}),t}function B(e,o){e.addEventListener("input",()=>{e.classList.remove(f),o.textContent=""})}function b(e,o,t,n){return e.has(`${o.toLowerCase()}|${t.toLowerCase()}|${n}`)}function $(e){e.textContent="This contact has already been recorded!"}function g(e,o){B(e,o);let t=/[a-zA-Z ]/gmi;return e.value.length<=3?(e.classList.add(f),o.textContent="Value cannot be shorter than 3 letters!",!1):t.test(e.value)?!0:(e.classList.add(f),o.textContent="Value must contain English letters!",!1)}function A(e,o){return B(e,o),/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(e.value)?!0:(e.classList.add(f),o.textContent="Wrong number!",!1)}var C=document.querySelector("#edit-popup"),I=C.querySelector(".popup__input--name"),T=C.querySelector(".popup__input--position"),h=C.querySelector(".popup__input--phone"),d=null;function L(e){d=e,I.value=e.querySelector(".message__name").textContent,T.value=e.querySelector(".message__position").textContent,h.value=e.querySelector(".message__phone").textContent,C.classList.add("popup--open"),C.querySelector("input").focus()}function H(){if(C.classList.remove("popup--open"),d){let e=d.querySelector(".message__edit");e&&e.focus()}d=null}function W(){let e=I.value.trim(),o=T.value.trim(),t=h.value,n=d.querySelector(".message__name").textContent,r=d.querySelector(".message__position").textContent,i=d.querySelector(".message__phone").textContent,a=[I,T,h],l=document.querySelector(".popup__error");if(w(h),!P(a,l))return;if(b(c,e,o,t)){$(l);return}if(!g(I,l)||!g(T,l)||!A(h,l))return;c.delete(`${n.toLowerCase()}|${r.toLowerCase()}|${i}`),c.set(`${e.toLowerCase()}|${o.toLowerCase()}|${t}`,{name:e,position:o,phone:t}),d.querySelector(".message__name").textContent=e,d.querySelector(".message__position").textContent=o,d.querySelector(".message__phone").textContent=t;let p=n[0].toUpperCase(),u=document.querySelector(`[data-id="${p.toLowerCase()}"]`)?.closest(".column__element");u&&u.querySelector(".element__contacts").querySelectorAll(".element__message").forEach(s=>{let v=s.querySelector(".message__name").textContent,k=s.querySelector(".message__position").textContent,M=s.querySelector(".message__phone").textContent;v===n&&k===r&&M===i&&(s.querySelector(".message__name").textContent=e,s.querySelector(".message__position").textContent=o,s.querySelector(".message__phone").textContent=t)}),_(),H()}document.querySelector(".popup").addEventListener("click",e=>{e.target.matches(".popup__button-save")&&W(),e.target.matches(".popup__overlay")&&H(),e.target.matches(".popup__button-cancel")&&H()});var V=(e,o,t)=>{let r=document.querySelector("#message").content.querySelector(".message").cloneNode(!0);return r.querySelector(".message__name").textContent=e,r.querySelector(".message__position").textContent=o,r.querySelector(".message__phone").textContent=t,r};function x(e,o,t,n,r=!0){let i=V(e,o,t),a=n.querySelector(".element__contacts");a.append(i);let l=n.querySelector(".element__counter");y(l,a),c.set(`${e.toLowerCase()}|${o.toLowerCase()}|${t}`,{name:e,position:o,phone:t}),r&&_()}function N(e){let o=e.target.closest(".message"),t=o.querySelector(".message__name").textContent,n=o.querySelector(".message__position").textContent,r=o.querySelector(".message__phone").textContent;c.delete(`${t.toLowerCase()}|${n.toLowerCase()}|${r}`),o.remove();let i=t[0].toUpperCase(),a=document.querySelector(`[data-id="${i.toLowerCase()}"]`)?.closest(".column__element");if(a){let l=a.querySelector(".element__contacts");l.querySelectorAll(".element__message").forEach(m=>{let S=m.querySelector(".message__name").textContent,s=m.querySelector(".message__position").textContent,v=m.querySelector(".message__phone").textContent;S===t&&s===n&&v===r&&m.remove()});let u=a.querySelector(".element__counter");y(u,l)}_()}function O(e){if(e.target.closest(".column__element")){let t=e.target.closest(".element").querySelector(".element__contacts");t.classList.toggle("element__contacts--open"),t.classList.contains("element__contacts--open")?t.style.maxHeight=`${t.scrollHeight}px`:t.style.maxHeight=0}}document.querySelector(".contact-table").addEventListener("click",e=>{if(e.target.matches(".message__delete")){N(e);return}if(e.target.matches(".message__edit")){let o=e.target.closest(".message");L(o);return}O(e)});document.querySelector(".contact-table").addEventListener("keydown",e=>{if(e.keyCode===32||e.key==="Enter"){if(e.preventDefault(),e.target.matches(".message__delete")){N(e);return}if(e.target.matches(".message__edit")){let o=e.target.closest(".message");L(o);return}O(e)}});var j=document.querySelector(".buttons__button--search"),E=document.querySelector(".modal"),U=E.querySelector(".modal__input"),q=E.querySelector(".modal__search-area");j.addEventListener("click",()=>{E.classList.add("modal--open"),document.querySelector(".body").style.overflow="hidden",E.querySelector("input").focus()});function K(e){let o=[];return c.forEach(({name:t,position:n,phone:r})=>{(t.toLowerCase().includes(e)||n.toLowerCase().includes(e)||r.includes(e))&&o.push({name:t,position:n,phone:r})}),o}function G(e){if(q.innerHTML="",e.length===0){q.textContent="No results found";return}e.forEach(({name:o,position:t,phone:n})=>{let r=V(o,t,n);q.appendChild(r)})}U.addEventListener("input",()=>{let e=U.value.trim().toLowerCase();if(e){let o=K(e);G(o)}else q.innerHTML=""});function Q(){let e=Array.from(c.values());G(e)}function Z(){E.classList.remove("modal--open"),U.value="",q.innerHTML="",document.querySelector(".body").style.overflow="auto"}document.querySelector(".modal").addEventListener("click",e=>{if(e.target.matches(".modal__button-show")&&Q(),e.target.matches(".modal__button-cancel")&&Z(),e.target.matches(".modal__overlay")&&Z(),e.target.matches(".message__edit")){let o=e.target.closest(".message");L(o)}e.target.matches(".message__delete")&&N(e)});var X=document.querySelector("#letter").content.querySelector(".element"),Y=({letter:e,id:o})=>{let t=X.cloneNode(!0);return t.querySelector(".element__letter").textContent=e,t.querySelector(".element__letter").dataset.id=o,t.setAttribute("tabindex","0"),t},D=(e,o)=>{let t=document.createDocumentFragment();e.forEach(n=>{let r=Y(n);t.append(r)}),o.append(t)};var J=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],R=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".column__left"),o=document.querySelector(".column__right");D(J,e),D(R,o),F();let t=document.getElementById("name"),n=document.getElementById("position"),r=document.getElementById("phone"),i=document.querySelector(".buttons__button--add");w(r),i.addEventListener("click",p=>{p.preventDefault();let u=t.value.trim(),m=n.value.trim(),S=r.value.trim(),s=document.querySelector(".interaction__error");if(!P([t,n,r],s))return;if(b(c,u,m,S)){$(s);return}if(!g(t,s)||!g(n,s)||!A(r,s))return;let k=u[0].toUpperCase(),M=document.querySelector(`[data-id="${k.toLowerCase()}"]`)?.closest(".column__element");x(u,m,S,M),t.value="",n.value="",r.value=""});let a=document.querySelector(".buttons__button--clear"),l=()=>{document.querySelectorAll(".column__element").forEach(p=>{let u=p.querySelector(".element__contacts");u.innerHTML="";let m=p.querySelector(".element__counter");y(m,u)}),c.clear(),_()};a.addEventListener("click",l)});
