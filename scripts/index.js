var te=document.querySelector("#letter").content.querySelector(".element"),oe=({letter:e,id:o})=>{let t=te.cloneNode(!0);return t.querySelector(".element__letter").textContent=e,t.querySelector(".element__letter").dataset.id=o,t.setAttribute("tabindex","0"),t},I=(e,o)=>{let t=document.createDocumentFragment();e.forEach(n=>{let r=oe(n);t.append(r)}),o.append(t)};var V=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],U=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];var ne=/[+][7][\d ()-]{12}/gu,L=document.querySelector(".interaction__error"),q="input--error";function re(e){e.classList.contains(q)||(e.classList.add(q),L.textContent="Fill in all fields!")}function D(e){let o=!0;return e.forEach(t=>{P(t),t.value.trim()||(re(t),o=!1)}),o}function P(e){e.addEventListener("input",()=>{e.classList.remove(q),L.textContent=""})}function O(e,o,t,n){return e.has(`${o.toLowerCase()}|${t.toLowerCase()}|${n}`)}function F(){L.textContent="This contact has already been recorded!"}function T(e){P(e);let o=/[a-zA-Z ]/gmi;return e.value.length<=3?(e.classList.add(q),L.textContent="Value cannot be shorter than 3 letters!",!1):o.test(e.value)?!0:(e.classList.add(q),L.textContent="Value must contain English letters!",!1)}function R(e){P(e);let o=e.value;return ne.test(o)?!0:(e.classList.add(q),L.textContent="Wrong number!",!1)}function v(e,o){let t=o.children.length,n=o.parentElement;t>0?(e.classList.add("element__counter--active"),n.classList.add("element--active"),e.textContent=t):(e.classList.remove("element__counter--active"),o.classList.remove("element--active"),e.textContent=0)}var i=new Map;function Z(){let e=localStorage.getItem("contacts");if(e)try{let o=JSON.parse(e);Array.isArray(o)&&o.forEach(({name:t,position:n,phone:r})=>{let p=t[0].toUpperCase(),u=document.querySelector(`[data-id="${p.toLowerCase()}"]`)?.closest(".column__element");u&&x(t,n,r,u)})}catch(o){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",o)}}function S(){let e=Array.from(i.values());localStorage.setItem("contacts",JSON.stringify(e))}var f=document.querySelector("#edit-popup"),G=f.querySelector(".popup__input--name"),J=f.querySelector(".popup__input--position"),z=f.querySelector(".popup__input--phone"),se=f.querySelector(".popup__button-save"),ce=f.querySelector(".popup__button-cancel"),ae=document.querySelector(".popup__overlay"),g=null;function W(e){g=e,G.value=e.querySelector(".message__name").textContent,J.value=e.querySelector(".message__position").textContent,z.value=e.querySelector(".message__phone").textContent,f.classList.add("popup--open")}function k(){f.classList.remove("popup--open"),g=null}se.addEventListener("click",()=>{let e=G.value.trim(),o=J.value.trim(),t=z.value.trim(),n=g.querySelector(".message__name").textContent,r=g.querySelector(".message__position").textContent,p=g.querySelector(".message__phone").textContent;i.delete(`${n.toLowerCase()}|${r.toLowerCase()}|${p}`),i.set(`${e.toLowerCase()}|${o.toLowerCase()}|${t}`,{name:e,position:o,phone:t}),g.querySelector(".message__name").textContent=e,g.querySelector(".message__position").textContent=o,g.querySelector(".message__phone").textContent=t;let u=n[0].toUpperCase(),y=document.querySelector(`[data-id="${u.toLowerCase()}"]`)?.closest(".column__element");y&&y.querySelector(".element__contacts").querySelectorAll(".element__message").forEach(a=>{let d=a.querySelector(".message__name").textContent,h=a.querySelector(".message__position").textContent,E=a.querySelector(".message__phone").textContent;d===n&&h===r&&E===p&&(a.querySelector(".message__name").textContent=e,a.querySelector(".message__position").textContent=o,a.querySelector(".message__phone").textContent=t)}),S(),k()});ae.addEventListener("click",k);ce.addEventListener("click",k);var M=(e,o,t)=>{let r=document.querySelector("#message").content.querySelector(".message").cloneNode(!0);return r.querySelector(".message__name").textContent=e,r.querySelector(".message__position").textContent=o,r.querySelector(".message__phone").textContent=t,r};function x(e,o,t,n,r=!0){let p=M(e,o,t),u=n.querySelector(".element__contacts");u.append(p);let y=n.querySelector(".element__counter");v(y,u),i.set(`${e.toLowerCase()}|${o.toLowerCase()}|${t}`,{name:e,position:o,phone:t}),r&&S()}document.addEventListener("click",e=>{if(e.target&&e.target.classList.contains("message__delete")){let o=e.target.closest(".message"),t=o.querySelector(".message__name").textContent,n=o.querySelector(".message__position").textContent,r=o.querySelector(".message__phone").textContent;i.delete(`${t.toLowerCase()}|${n.toLowerCase()}|${r}`),o.remove();let p=t[0].toUpperCase(),u=document.querySelector(`[data-id="${p.toLowerCase()}"]`)?.closest(".column__element");if(u){let y=u.querySelector(".element__contacts");y.querySelectorAll(".element__message").forEach(a=>{let d=a.querySelector(".message__name").textContent,h=a.querySelector(".message__position").textContent,E=a.querySelector(".message__phone").textContent;d===t&&h===n&&E===r&&a.remove()});let m=u.querySelector(".element__counter");v(m,y)}o.remove(),S()}});document.addEventListener("click",e=>{if(e.target.classList.contains("message__edit")){let o=e.target.closest(".message");W(o)}});function j(e){if(e.target.closest(".column__element")){let t=e.target.closest(".element").querySelector(".element__contacts");t.classList.toggle("element__contacts--open"),t.classList.contains("element__contacts--open")?t.style.maxHeight=`${t.scrollHeight}px`:t.style.maxHeight=0}}document.querySelector(".contact-table").addEventListener("click",j);document.querySelector(".contact-table").addEventListener("keydown",e=>{(e.keyCode===32||e.key==="Enter")&&(e.preventDefault(),j(e))});var B=0,K=e=>{e.addEventListener("input",()=>{let o=e.value.replace(/\D/g,""),t=e.value.length;if(t<B){B--;return}e.value="+7 ",t>1&&(e.value+=o.substring(1,4)),t>=4&&(e.value+=` ${o.substring(4,7)}`),t>=7&&(e.value+=`${o.substring(7,9)}`),t>=9&&(e.value+=`${o.substring(9,11)}`),B++})};document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".column__left"),o=document.querySelector(".column__right");I(V,e),I(U,o),Z();let t=document.getElementById("name"),n=document.getElementById("position"),r=document.getElementById("phone");document.querySelector(".buttons__button--add").addEventListener("click",s=>{s.preventDefault();let c=t.value.trim(),l=n.value.trim(),_=r.value.trim();if(!D([t,n,r]))return;if(O(i,c,l,_)){F();return}if(!T(t)||!T(n)||!R(r))return;let $=c[0].toUpperCase(),A=document.querySelector(`[data-id="${$.toLowerCase()}"]`)?.closest(".column__element");x(c,l,_,A),t.value="",n.value="",r.value=""});let u=document.querySelector(".buttons__button--clear"),y=()=>{document.querySelectorAll(".column__element").forEach(s=>{let c=s.querySelector(".element__contacts");c.innerHTML="";let l=s.querySelector(".element__counter");v(l,c)}),i.clear(),S()};u.addEventListener("click",y);let w=document.querySelector(".buttons__button--search"),m=document.querySelector(".modal"),a=m.querySelector(".modal__input"),d=m.querySelector(".modal__search-area"),h=m.querySelector(".modal__button-cancel"),E=m.querySelector(".modal__overlay"),Q=m.querySelector(".modal__button-show");w.addEventListener("click",()=>{m.classList.add("modal--open"),document.querySelector(".body").style.overflow="hidden"});function X(s){let c=[];return i.forEach(({name:l,position:_,phone:C})=>{(l.toLowerCase().includes(s)||_.toLowerCase().includes(s)||C.includes(s))&&c.push({name:l,position:_,phone:C})}),c}function N(s){if(d.innerHTML="",s.length===0){d.textContent="No results found";return}s.forEach(({name:c,position:l,phone:_})=>{let C=M(c,l,_);d.appendChild(C)})}a.addEventListener("input",()=>{let s=a.value.trim().toLowerCase();if(s){let c=X(s);N(c)}else d.innerHTML=""}),d.addEventListener("click",s=>{let c=s.target.closest(".message__delete");if(c){let l=c.closest(".element__message");if(l){let _=l.querySelector(".message__name").textContent,C=l.querySelector(".message__position").textContent,$=l.querySelector(".message__phone").textContent;i.delete(`${_.toLowerCase()}|${C.toLowerCase()}|${$}`),l.remove();let A=_[0].toUpperCase(),b=document.querySelector(`[data-id="${A.toLowerCase()}"]`)?.closest(".column__element");if(b){let Y=b.querySelector(".element__counter"),ee=b.querySelector(".element__contacts");v(Y,ee)}}}}),Q.addEventListener("click",()=>{let s=Array.from(i.values());N(s)});function H(){m.classList.remove("modal--open"),a.value="",d.innerHTML="",document.querySelector(".body").style.overflow="auto"}h.addEventListener("click",H),E.addEventListener("click",H),K(r)});
