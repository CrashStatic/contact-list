var Z="input--error";function it(t,e){t.forEach(o=>{o.classList.remove(Z)}),e.textContent=""}function N(t,e,o){t.classList.add(Z),e.textContent=o}function ut(t){let e=[];return t.forEach(o=>{o.value.trim()||e.push({input:o,message:"Fill in all fields!"})}),e}function mt(t,e,o,n){return t.some(c=>c.name.toLowerCase()===e.toLowerCase()&&c.position.toLowerCase()===o.toLowerCase()&&c.phone===n)?[{input:null,message:"This contact has already been recorded!"}]:[]}function V(t,e){let o=[],n=/^[a-zA-Z]+$/;return t.value.length<e&&o.push({input:t,message:`Value cannot be shorter than ${e} letters!`}),n.test(t.value)||o.push({input:t,message:"Value must contain English letters!"}),o}function dt(t){return/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(t.value)?[]:[{input:t,message:"Wrong number!"}]}function O(t,e,o){let[n,r,c]=t;it(t,o);let s=ut(t);if(s.length>0)return{ok:!1,errors:s};let a=mt(e,n.value,r.value,c.value);if(a.length>0)return{ok:!1,errors:a};let p=V(n,3);if(p.length>0)return{ok:!1,errors:p};let m=V(r,3);if(m.length>0)return{ok:!1,errors:m};let f=dt(c);return f.length>0?{ok:!1,errors:f}:{ok:!0,errors:[]}}var _=class{constructor(e,o){this.counterElement=e,this.contactsContainer=o,this.count=0}increase(){this.count++,this.update()}decrease(){this.count>0&&(this.count--,this.update())}reset(){this.count=0,this.update()}update(){let e=this.contactsContainer.parentElement;this.count>0?(this.counterElement.classList.add("element__counter--active"),e.classList.add("element--active")):(this.counterElement.classList.remove("element__counter--active"),e.classList.remove("element--active")),this.counterElement.textContent=this.count}};var g=".element__contacts",E=".message__name",C=".message__position",S=".message__phone",A=".element__counter",d=".column__element";function J(t){let e=localStorage.getItem(t);if(e)try{return JSON.parse(e)}catch(o){return console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",o),o}}function L(t,e){localStorage.setItem(t,JSON.stringify(e))}var q="contacts",i=J(q)||[];function u(){return i}function z(t,e,o){let n={name:t,position:e,phone:o};i.push(n),L(q,i)}function W(t,e,o){i=i.filter(n=>n.name!==t||n.position!==e||n.phone!==o),L(q,i)}function Y(t){return i.filter(({name:e,position:o,phone:n})=>e.toLowerCase().includes(t.toLowerCase())||o.toLowerCase().includes(t.toLowerCase())||n.includes(t))}function Q(t,e){i=i.map(o=>o.name===t.name&&o.position===t.position&&o.phone===t.phone?e:o),L(q,i)}function X(){i=[],L(q,i)}var tt=t=>t.key==="Escape";var l=document.querySelector(".modal");function w(t){l.showModal(),document.querySelector(".body").style.overflow="hidden";let e=l.querySelector(".modal__body");e.innerHTML="";let o=t.content.cloneNode(!0);e.appendChild(o),l.querySelector("input").focus(),document.addEventListener("keydown",I)}function T(){l.close(),document.querySelector(".body").style.overflow="auto",document.removeEventListener("keydown",I)}function I(t){tt(t)&&(t.preventDefault(),T())}var b=t=>{let e="";t.addEventListener("input",()=>{let o=t.value.replace(/\D/g,"");if(o.length<e.length){e=o;return}o.length===1&&o[0]!=="7"&&(o=`7${o}`);let n="+7 ";o.length>1&&(n+=o.substring(1,4)),o.length>4&&(n+=` ${o.substring(4,7)}`),o.length>7&&(n+=` ${o.substring(7,9)}`),o.length>9&&(n+=` ${o.substring(9,11)}`),t.value=n,e=o})};var pt=document.querySelector("#edit-popup-content"),P,R,v,h=null;function x(t){w(pt);let e=l.querySelector(".modal__title");e.textContent="Edit contact",h=t,P=l.querySelector("#popup-name"),R=l.querySelector("#popup-position"),v=l.querySelector("#popup-phone"),P.value=t.querySelector(E).textContent,R.value=t.querySelector(C).textContent,v.value=t.querySelector(S).textContent,l.querySelector("input").focus(),document.addEventListener("keydown",I)}function et(){let t=P.value.trim(),e=R.value.trim(),o=v.value,n=h.querySelector(E).textContent,r=h.querySelector(C).textContent,c=h.querySelector(S).textContent,s=[P,R,v],a=document.querySelector(".popup__error");b(v);let{ok:p,errors:m}=O(s,u(),a);if(!p){m.forEach(({input:y,message:K})=>{y?N(y,a,K):a.textContent=K});return}let f={name:n,position:r,phone:c},F={name:t,position:e,phone:o};if(Q(f,F),ot(f,F),T(),h){let y=h.querySelector(".js-edit-contact-button");y&&y.focus()}h=null}var k={};function G(t,e,o){let r=document.querySelector("#message").content.querySelector(".message").cloneNode(!0);return r.querySelector(E).textContent=t,r.querySelector(C).textContent=e,r.querySelector(S).textContent=o,r}function ft(t,e){e.innerHTML="",t.forEach(({name:o,position:n,phone:r})=>{let c=G(o,n,r);e.append(c)})}function nt(t,e){let o=document.querySelector(`[data-id="${t.toLowerCase()}"]`)?.closest(d);if(o){let n=o.querySelector(g);ft(e,n);let r=o.querySelector(A);k[t]||(k[t]=new _(r,n)),k[t].count=e.length,k[t].update()}}function U(t,e,o,n,r=!0){r&&z(t,e,o);let c=n.querySelector("[data-id]").textContent.toUpperCase(),s=u().filter(a=>a.name[0].toUpperCase()===c);nt(c,s)}function H(t){let e=t.target.closest(".message"),o=e.querySelector(E).textContent,n=e.querySelector(C).textContent,r=e.querySelector(S).textContent;W(o,n,r),e.remove();let c=o[0].toUpperCase(),s=u().filter(a=>a.name[0].toUpperCase()===c);nt(c,s)}function ot(t,e){let o=t.name[0].toUpperCase(),n=document.querySelector(`[data-id="${o.toLowerCase()}"]`)?.closest(d);n&&n.querySelector(g).querySelectorAll(".element__message").forEach(s=>{let a=s.querySelector(E).textContent,p=s.querySelector(C).textContent,m=s.querySelector(S).textContent;a===t.name&&p===t.position&&m===t.phone&&(s.querySelector(E).textContent=e.name,s.querySelector(C).textContent=e.position,s.querySelector(S).textContent=e.phone)})}function rt(t){if(t.target.closest(d)){let o=t.target.closest(".element").querySelector(g);o.classList.toggle("element__contacts--open"),o.classList.contains("element__contacts--open")?o.style.maxHeight=`${o.scrollHeight}px`:o.style.maxHeight=0}}document.querySelector(".contact-table").addEventListener("click",t=>{if(t.target.closest(".js-delete-contact-button")){H(t);return}if(t.target.closest(".js-edit-contact-button")){let e=t.target.closest(".message");x(e);return}rt(t)});document.querySelector(".contact-table").addEventListener("keydown",t=>{if(t.keyCode===32||t.key==="Enter"){if(t.preventDefault(),t.target.matches(".js-delete-contact-button")){H(t);return}if(t.target.matches(".js-edit-contact-button")){let e=t.target.closest(".message");x(e);return}rt(t)}});var Et=document.querySelector("#search-modal-content");function ct(t,e){if(e.innerHTML="",t.length===0){e.textContent="No results found";return}t.forEach(({name:o,position:n,phone:r})=>{let c=G(o,n,r);e.appendChild(c)})}function Ct(t,e){t.addEventListener("input",()=>{let o=t.value.trim().toLowerCase();if(o){let n=Y(o);ct(n,e)}else e.innerHTML=""})}function st(){w(Et);let t=l.querySelector(".modal__input"),e=l.querySelector(".modal__search-area");Ct(t,e),l.querySelector(".modal__button-show").addEventListener("click",B)}function B(){let t=u(),e=l.querySelector(".modal__search-area");ct(t,e),l.querySelector("input").focus()}var $=document.getElementById("name"),j=document.getElementById("position"),M=document.getElementById("phone");function St(){let t=$.value.trim(),e=j.value.trim(),o=M.value.trim(),n=document.querySelector(".form__error"),r=[$,j,M],{ok:c,errors:s}=O(r,u(),n);if(!c){s.forEach(({input:m,message:f})=>{m?N(m,n,f):n.textContent=f});return}let a=t[0].toUpperCase(),p=document.querySelector(`[data-id="${a.toLowerCase()}"]`)?.closest(d);U(t,e,o,p),$.value="",j.value="",M.value=""}function ht(){document.querySelectorAll(d).forEach(t=>{let e=t.querySelector(g);e.innerHTML="";let o=t.querySelector(A);new _(o,e).reset()}),X()}document.querySelector(".form").addEventListener("submit",t=>{t.preventDefault(),St()});document.querySelector(".form__buttons").addEventListener("click",t=>{t.target.matches(".js-clear-contact-button")&&ht(),t.target.matches(".js-search-contact-button")&&st()});var _t=document.querySelector("#letter").content.querySelector(".element"),gt=({letter:t,id:e})=>{let o=_t.cloneNode(!0);return o.querySelector(".element__letter").textContent=t,o.querySelector(".element__letter").dataset.id=e,o.setAttribute("tabindex","0"),o},D=(t,e)=>{let o=document.createDocumentFragment();t.forEach(n=>{let r=gt(n);o.append(r)}),e.append(o)};var at=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],lt=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector(".column-left"),e=document.querySelector(".column-right");D(at,t),D(lt,e),u().forEach(({name:n,position:r,phone:c})=>{let s=n[0].toUpperCase(),a=document.querySelector(`[data-id="${s.toLowerCase()}"]`)?.closest(d);a&&U(n,r,c,a,!1)}),b(M),document.querySelector(".modal").addEventListener("click",n=>{if(n.target.matches(".modal__button-show")&&B(),n.target.matches(".form__button--popup-save")&&et(),n.target.closest(".js-delete-contact-button")){H(n);return}if(n.target.closest(".js-edit-contact-button")){let r=n.target.closest(".message");x(r);return}(n.target.closest(".modal__close-button")||n.target.matches(".modal__overlay"))&&T()})});
