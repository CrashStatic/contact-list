var Y=document.querySelector("#letter").content.querySelector(".element"),ee=({letter:y,id:C})=>{let l=Y.cloneNode(!0);return l.querySelector(".element__letter").textContent=y,l.querySelector(".element__letter").dataset.id=C,l.setAttribute("tabindex","0"),l},w=(y,C)=>{let l=document.createDocumentFragment();y.forEach(S=>{let g=ee(S);l.append(g)}),C.append(l)};var N=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],H=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];document.addEventListener("DOMContentLoaded",()=>{let y=document.querySelector(".column__left"),C=document.querySelector(".column__right");w(N,y),w(H,C);let l=document.getElementById("name"),S=document.getElementById("position"),g=document.getElementById("phone"),U=document.querySelector(".buttons__button--add"),a=new Map;function D(){let e=localStorage.getItem("contacts");if(e)try{let t=JSON.parse(e);Array.isArray(t)&&t.forEach(({name:o,position:n,phone:c})=>{let s=o[0].toUpperCase(),u=document.querySelector(`[data-id="${s.toLowerCase()}"]`)?.closest(".column__element");u&&B(o,n,c,u)})}catch(t){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",t)}}function q(){let e=Array.from(a.values());localStorage.setItem("contacts",JSON.stringify(e))}function A(e,t,o){return a.has(`${e.toLowerCase()}|${t.toLowerCase()}|${o}`)}let $=(e,t,o)=>{let c=document.querySelector("#message").content.querySelector(".message").cloneNode(!0);return c.querySelector(".message__name").textContent=e,c.querySelector(".message__position").textContent=t,c.querySelector(".message__phone").textContent=o,c};function B(e,t,o,n,c=!0){let s=$(e,t,o);n.querySelector(".element__contacts").append(s),L(n),a.set(`${e.toLowerCase()}|${t.toLowerCase()}|${o}`,{name:e,position:t,phone:o}),c&&q()}U.addEventListener("click",e=>{e.preventDefault();let t=l.value.trim(),o=S.value.trim(),n=g.value.trim();if(!t||!o||!n){alert("\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0432\u0441\u0435 \u043F\u043E\u043B\u044F");return}if(A(t,o,n)){alert("\u042D\u0442\u043E\u0442 \u043A\u043E\u043D\u0442\u0430\u043A\u0442 \u0443\u0436\u0435 \u0437\u0430\u043F\u0438\u0441\u0430\u043D!");return}let c=t[0].toUpperCase(),s=document.querySelector(`[data-id="${c.toLowerCase()}"]`)?.closest(".column__element");B(t,o,n,s),l.value="",S.value="",g.value=""}),document.querySelectorAll(".element__container").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();let n=t.target.closest(".element").querySelector(".element__contacts");n.classList.toggle("element__contacts--open"),n.classList.contains("element__contacts--open")?n.style.maxHeight=`${n.scrollHeight}px`:n.style.maxHeight=0})});function L(e){let t=e.querySelector(".element__counter"),n=e.querySelector(".element__contacts").children.length;n>0?(t.classList.add("element__counter--active"),t.textContent=n):(t.classList.remove("element__counter--active"),t.textContent=0)}let O=e=>{let t=e.target.closest(".message__delete");if(!t)return;let o=t.closest(".message"),n=o.querySelector(".message__name").textContent,c=o.querySelector(".message__position").textContent,s=o.querySelector(".message__phone").textContent;if(a.delete(`${n.toLowerCase()}|${c.toLowerCase()}|${s}`),o){o.remove();let u=n[0].toUpperCase(),i=document.querySelector(`[data-id="${u.toLowerCase()}"]`)?.closest(".column__element");i&&(i.querySelector(".element__contacts").querySelectorAll(".element__message").forEach(r=>{let v=r.querySelector(".message__name").textContent,E=r.querySelector(".message__position").textContent,x=r.querySelector(".message__phone").textContent;v===n&&E===c&&x===s&&r.remove()}),L(i)),o.remove(),q()}};document.addEventListener("click",O);let F=document.querySelector(".buttons__button--clear"),J=()=>{document.querySelectorAll(".column__element").forEach(e=>{let t=e.querySelector(".element__contacts");t.innerHTML="",L(e)}),a.clear(),q()};F.addEventListener("click",J),D();let d=document.querySelector("#edit-popup"),P=d.querySelector(".popup__input--name"),b=d.querySelector(".popup__input--position"),k=d.querySelector(".popup__input--phone"),R=d.querySelector(".popup__button-save"),Z=d.querySelector(".popup__button-cancel"),j=document.querySelector(".popup__overlay"),m=null;function T(e){m=e,P.value=e.querySelector(".message__name").textContent,b.value=e.querySelector(".message__position").textContent,k.value=e.querySelector(".message__phone").textContent,d.classList.add("popup--open")}function f(){d.classList.remove("popup--open"),m=null}R.addEventListener("click",()=>{let e=P.value.trim(),t=b.value.trim(),o=k.value.trim();if(!e||!t||!o){alert("\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0432\u0441\u0435 \u043F\u043E\u043B\u044F");return}let n=m.querySelector(".message__name").textContent,c=m.querySelector(".message__position").textContent,s=m.querySelector(".message__phone").textContent;if((e!==n||t!==c||o!==s)&&A(e,t,o)){alert("\u042D\u0442\u043E\u0442 \u043A\u043E\u043D\u0442\u0430\u043A\u0442 \u0443\u0436\u0435 \u0437\u0430\u043F\u0438\u0441\u0430\u043D!");return}a.delete(`${n.toLowerCase()}|${c.toLowerCase()}|${s}`),a.set(`${e.toLowerCase()}|${t.toLowerCase()}|${o}`,{name:e,position:t,phone:o}),m.querySelector(".message__name").textContent=e,m.querySelector(".message__position").textContent=t,m.querySelector(".message__phone").textContent=o;let u=n[0].toUpperCase(),i=document.querySelector(`[data-id="${u.toLowerCase()}"]`)?.closest(".column__element");i&&i.querySelector(".element__contacts").querySelectorAll(".element__message").forEach(r=>{let v=r.querySelector(".message__name").textContent,E=r.querySelector(".message__position").textContent,x=r.querySelector(".message__phone").textContent;v===n&&E===c&&x===s&&(r.querySelector(".message__name").textContent=e,r.querySelector(".message__position").textContent=t,r.querySelector(".message__phone").textContent=o)}),q(),f()}),j.addEventListener("click",f),Z.addEventListener("click",f),document.addEventListener("click",e=>{if(e.target.classList.contains("message__edit")){let t=e.target.closest(".message");T(t)}});let z=document.querySelector(".buttons__button--search"),_=document.querySelector(".modal"),h=_.querySelector(".modal__input"),p=_.querySelector(".modal__search-area"),G=_.querySelector(".modal__button-cancel"),K=_.querySelector(".modal__overlay"),Q=_.querySelector(".modal__button-show");z.addEventListener("click",()=>{_.classList.add("modal--open"),document.querySelector(".body").style.overflow="hidden"});function V(e){let t=[];return a.forEach(({name:o,position:n,phone:c})=>{(o.toLowerCase().includes(e)||n.toLowerCase().includes(e)||c.includes(e))&&t.push({name:o,position:n,phone:c})}),t}function I(e){if(p.innerHTML="",e.length===0){p.textContent="No results found";return}e.forEach(({name:t,position:o,phone:n})=>{let c=$(t,o,n);p.appendChild(c)})}h.addEventListener("input",()=>{let e=h.value.trim().toLowerCase();if(e){let t=V(e);I(t)}else p.innerHTML=""}),p.addEventListener("click",e=>{let t=e.target.closest(".message__delete");if(t){let o=t.closest(".element__message");if(o){let n=o.querySelector(".message__name").textContent,c=o.querySelector(".message__position").textContent,s=o.querySelector(".message__phone").textContent;a.delete(`${n.toLowerCase()}|${c.toLowerCase()}|${s}`),o.remove();let u=n[0].toUpperCase(),i=document.querySelector(`[data-id="${u.toLowerCase()}"]`)?.closest(".column__element");i&&L(i)}}}),p.addEventListener("click",e=>{let t=e.target.closest(".message__edit");if(t){let o=t.closest(".element__message");o&&T(o)}}),Q.addEventListener("click",()=>{let e=Array.from(a.values());I(e)});function M(){_.classList.remove("modal--open"),h.value="",p.innerHTML="",document.querySelector(".body").style.overflow="auto"}G.addEventListener("click",M),K.addEventListener("click",M)});
