var Y=document.querySelector("#letter").content.querySelector(".element"),ee=({letter:e,id:o})=>{let t=Y.cloneNode(!0);return t.querySelector(".element__letter").textContent=e,t.querySelector(".element__letter").dataset.id=o,t.setAttribute("tabindex","0"),t},U=(e,o)=>{let t=document.createDocumentFragment();e.forEach(n=>{let r=ee(n);t.append(r)}),o.append(t)};var R=[{letter:"A",id:"a"},{letter:"B",id:"b"},{letter:"C",id:"c"},{letter:"D",id:"d"},{letter:"E",id:"e"},{letter:"F",id:"f"},{letter:"G",id:"g"},{letter:"H",id:"h"},{letter:"I",id:"i"},{letter:"J",id:"j"},{letter:"K",id:"k"},{letter:"L",id:"l"},{letter:"M",id:"m"}],z=[{letter:"N",id:"n"},{letter:"O",id:"o"},{letter:"P",id:"p"},{letter:"Q",id:"q"},{letter:"R",id:"r"},{letter:"S",id:"s"},{letter:"T",id:"t"},{letter:"U",id:"U"},{letter:"V",id:"v"},{letter:"W",id:"w"},{letter:"X",id:"x"},{letter:"Y",id:"y"},{letter:"Z",id:"z"}];var h="input--error";function te(e,o){e.classList.contains(h)||(e.classList.add(h),o.textContent="Fill in all fields!")}function b(e,o){let t=!0;return e.forEach(n=>{D(n,o),n.value.trim()||(te(n,o),t=!1)}),t}function D(e,o){e.addEventListener("input",()=>{e.classList.remove(h),o.textContent=""})}function P(e,o,t,n){return e.has(`${o.toLowerCase()}|${t.toLowerCase()}|${n}`)}function A(e){e.textContent="This contact has already been recorded!"}function q(e,o){D(e,o);let t=/[a-zA-Z ]/gmi;return e.value.length<=3?(e.classList.add(h),o.textContent="Value cannot be shorter than 3 letters!",!1):t.test(e.value)?!0:(e.classList.add(h),o.textContent="Value must contain English letters!",!1)}function I(e,o){return D(e,o),/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(e.value)?!0:(e.classList.add(h),o.textContent="Wrong number!",!1)}function v(e,o){let t=o.children.length,n=o.parentElement;t>0?(e.classList.add("element__counter--active"),n.classList.add("element--active"),e.textContent=t):(e.classList.remove("element__counter--active"),n.classList.remove("element--active"),e.textContent=0)}var l=new Map;function W(){let e=localStorage.getItem("contacts");if(e)try{let o=JSON.parse(e);Array.isArray(o)&&o.forEach(({name:t,position:n,phone:r})=>{let p=t[0].toUpperCase(),u=document.querySelector(`[data-id="${p.toLowerCase()}"]`)?.closest(".column__element");u&&k(t,n,r,u)})}catch(o){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",o)}}function S(){let e=Array.from(l.values());localStorage.setItem("contacts",JSON.stringify(e))}var T=e=>{let o="";e.addEventListener("input",()=>{let t=e.value.replace(/\D/g,"");if(t.length<o.length){o=t;return}t.length===1&&t[0]!=="7"&&(t=`7${t}`);let n="+7 ";t.length>1&&(n+=t.substring(1,4)),t.length>4&&(n+=` ${t.substring(4,7)}`),t.length>7&&(n+=` ${t.substring(7,9)}`),t.length>9&&(n+=` ${t.substring(9,11)}`),e.value=n,o=t})};var L=document.querySelector("#edit-popup"),N=L.querySelector(".popup__input--name"),B=L.querySelector(".popup__input--position"),w=L.querySelector(".popup__input--phone"),oe=L.querySelector(".popup__button-save"),ne=L.querySelector(".popup__button-cancel"),re=document.querySelector(".popup__overlay"),C=null;function j(e){C=e,N.value=e.querySelector(".message__name").textContent,B.value=e.querySelector(".message__position").textContent,w.value=e.querySelector(".message__phone").textContent,L.classList.add("popup--open")}function O(){L.classList.remove("popup--open"),C=null}oe.addEventListener("click",()=>{let e=N.value.trim(),o=B.value.trim(),t=w.value,n=C.querySelector(".message__name").textContent,r=C.querySelector(".message__position").textContent,p=C.querySelector(".message__phone").textContent,u=[N,B,w],i=document.querySelector(".popup__error");if(T(w),!b(u,i))return;if(P(l,e,o,t)){A(i);return}if(!q(N,i)||!q(B,i)||!I(w,i))return;l.delete(`${n.toLowerCase()}|${r.toLowerCase()}|${p}`),l.set(`${e.toLowerCase()}|${o.toLowerCase()}|${t}`,{name:e,position:o,phone:t}),C.querySelector(".message__name").textContent=e,C.querySelector(".message__position").textContent=o,C.querySelector(".message__phone").textContent=t;let $=n[0].toUpperCase(),m=document.querySelector(`[data-id="${$.toLowerCase()}"]`)?.closest(".column__element");m&&m.querySelector(".element__contacts").querySelectorAll(".element__message").forEach(_=>{let E=_.querySelector(".message__name").textContent,M=_.querySelector(".message__position").textContent,H=_.querySelector(".message__phone").textContent;E===n&&M===r&&H===p&&(_.querySelector(".message__name").textContent=e,_.querySelector(".message__position").textContent=o,_.querySelector(".message__phone").textContent=t)}),S(),O()});re.addEventListener("click",O);ne.addEventListener("click",O);var F=(e,o,t)=>{let r=document.querySelector("#message").content.querySelector(".message").cloneNode(!0);return r.querySelector(".message__name").textContent=e,r.querySelector(".message__position").textContent=o,r.querySelector(".message__phone").textContent=t,r};function k(e,o,t,n,r=!0){let p=F(e,o,t),u=n.querySelector(".element__contacts");u.append(p);let i=n.querySelector(".element__counter");v(i,u),l.set(`${e.toLowerCase()}|${o.toLowerCase()}|${t}`,{name:e,position:o,phone:t}),r&&S()}document.addEventListener("click",e=>{if(e.target&&e.target.classList.contains("message__delete")){let o=e.target.closest(".message"),t=o.querySelector(".message__name").textContent,n=o.querySelector(".message__position").textContent,r=o.querySelector(".message__phone").textContent;l.delete(`${t.toLowerCase()}|${n.toLowerCase()}|${r}`),o.remove();let p=t[0].toUpperCase(),u=document.querySelector(`[data-id="${p.toLowerCase()}"]`)?.closest(".column__element");if(u){let i=u.querySelector(".element__contacts");i.querySelectorAll(".element__message").forEach(y=>{let g=y.querySelector(".message__name").textContent,_=y.querySelector(".message__position").textContent,E=y.querySelector(".message__phone").textContent;g===t&&_===n&&E===r&&y.remove()});let m=u.querySelector(".element__counter");v(m,i)}o.remove(),S()}});document.addEventListener("click",e=>{if(e.target.classList.contains("message__edit")){let o=e.target.closest(".message");j(o)}});function K(e){if(e.target.closest(".column__element")){let t=e.target.closest(".element").querySelector(".element__contacts");t.classList.toggle("element__contacts--open"),t.classList.contains("element__contacts--open")?t.style.maxHeight=`${t.scrollHeight}px`:t.style.maxHeight=0}}document.querySelector(".contact-table").addEventListener("click",K);document.querySelector(".contact-table").addEventListener("keydown",e=>{(e.keyCode===32||e.key==="Enter")&&(e.preventDefault(),K(e))});document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".column__left"),o=document.querySelector(".column__right");U(R,e),U(z,o),W();let t=document.getElementById("name"),n=document.getElementById("position"),r=document.getElementById("phone"),p=document.querySelector(".buttons__button--add");T(r),p.addEventListener("click",c=>{c.preventDefault();let s=t.value.trim(),a=n.value.trim(),f=r.value.trim(),d=document.querySelector(".interaction__error");if(!b([t,n,r],d))return;if(P(l,s,a,f)){A(d);return}if(!q(t,d)||!q(n,d)||!I(r,d))return;let V=s[0].toUpperCase(),x=document.querySelector(`[data-id="${V.toLowerCase()}"]`)?.closest(".column__element");k(s,a,f,x),t.value="",n.value="",r.value=""});let u=document.querySelector(".buttons__button--clear"),i=()=>{document.querySelectorAll(".column__element").forEach(c=>{let s=c.querySelector(".element__contacts");s.innerHTML="";let a=c.querySelector(".element__counter");v(a,s)}),l.clear(),S()};u.addEventListener("click",i);let $=document.querySelector(".buttons__button--search"),m=document.querySelector(".modal"),y=m.querySelector(".modal__input"),g=m.querySelector(".modal__search-area"),_=m.querySelector(".modal__button-cancel"),E=m.querySelector(".modal__overlay"),M=m.querySelector(".modal__button-show");$.addEventListener("click",()=>{m.classList.add("modal--open"),document.querySelector(".body").style.overflow="hidden"});function H(c){let s=[];return l.forEach(({name:a,position:f,phone:d})=>{(a.toLowerCase().includes(c)||f.toLowerCase().includes(c)||d.includes(c))&&s.push({name:a,position:f,phone:d})}),s}function Z(c){if(g.innerHTML="",c.length===0){g.textContent="No results found";return}c.forEach(({name:s,position:a,phone:f})=>{let d=F(s,a,f);g.appendChild(d)})}y.addEventListener("input",()=>{let c=y.value.trim().toLowerCase();if(c){let s=H(c);Z(s)}else g.innerHTML=""}),g.addEventListener("click",c=>{let s=c.target.closest(".message__delete");if(s){let a=s.closest(".element__message");if(a){let f=a.querySelector(".message__name").textContent,d=a.querySelector(".message__position").textContent,J=a.querySelector(".message__phone").textContent;l.delete(`${f.toLowerCase()}|${d.toLowerCase()}|${J}`),a.remove();let V=f[0].toUpperCase(),x=document.querySelector(`[data-id="${V.toLowerCase()}"]`)?.closest(".column__element");if(x){let Q=x.querySelector(".element__counter"),X=x.querySelector(".element__contacts");v(Q,X)}}}}),M.addEventListener("click",()=>{let c=Array.from(l.values());Z(c)});function G(){m.classList.remove("modal--open"),y.value="",g.innerHTML="",document.querySelector(".body").style.overflow="auto"}_.addEventListener("click",G),E.addEventListener("click",G)});
