var k=".body";var G="#message";var F=".element",v="element--active";var g=".element__contacts",P="element__contacts--open",V=".element__counter",H="element__counter--active",$=".element__message",x=".column__element",C=".message",f=".message__name",_=".message__position",L=".message__phone",q=".contact-table",D=".js-delete-contact-button",h=".js-edit-contact-button";var K="#edit-popup-content",Y="#popup-name",j="#popup-position",J="#popup-phone",W=".popup__error",z=".modal",Z=".modal__title",Q=".modal__body";var y=class{constructor(o,e){this.counterElement=o,this.contactsContainer=e,this.count=0}increase(){this.count++,this.update()}decrease(){this.count>0&&(this.count--,this.update())}reset(){this.count=0,this.update()}update(){let o=this.contactsContainer.parentElement;o&&(this.count>0?(this.counterElement.classList.add(H),o.classList.add(v)):(this.counterElement.classList.remove(H),o.classList.remove(v))),this.counterElement.textContent=this.count.toString()}};function X(t){let o=localStorage.getItem(t);if(o)try{return JSON.parse(o)}catch(e){throw console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage:",e),new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0430 \u0434\u0430\u043D\u043D\u044B\u0445 \u0438\u0437 localStorage")}return null}function b(t,o){localStorage.setItem(t,JSON.stringify(o))}var w="contacts",d=X(w)||[];function N(){return d}function tt({name:t,position:o,phone:e}){d=d.filter(n=>n.name!==t||n.position!==o||n.phone!==e),b(w,d)}function et(t,o){d=d.map(e=>e.name===t.name&&e.position===t.position&&e.phone===t.phone?o:e),b(w,d)}var A={};function Ct({name:t,position:o,phone:e}){let r=document.querySelector(G).content.querySelector(C)?.cloneNode(!0);if(r){let s=r.querySelector(f),a=r.querySelector(_),l=r.querySelector(L);s.textContent=t,a.textContent=o,l.textContent=e}return r}function ft(t,o){o.innerHTML="",t.forEach(({name:e,position:n,phone:c})=>{let r=Ct({name:e,position:n,phone:c});o.append(r)})}function _t(t,o){let e=document.querySelector(`[data-id="${t.toLowerCase()}"]`)?.closest(x);if(e){let n=e.querySelector(g);ft(o,n);let c=e.querySelector(V);A[t]||(A[t]=new y(c,n)),A[t].count=o.length,A[t].update()}}function ot(t){let e=t.target.closest(C);if(!e)return;let n=e.querySelector(f)?.textContent??"",c=e.querySelector(_)?.textContent??"",r=e.querySelector(L)?.textContent??"";tt({name:n,position:c,phone:r}),e.remove();let s=n[0].toUpperCase(),a=N().filter(l=>l.name[0].toUpperCase()===s);_t(s,a)}function nt(t,o){let e=t.name[0].toUpperCase(),n=document.querySelector(`[data-id="${e.toLowerCase()}"]`)?.closest(x);n&&n.querySelector(g).querySelectorAll($).forEach(s=>{let a=s.querySelector(f)?.textContent??"",l=s.querySelector(_)?.textContent??"",S=s.querySelector(L)?.textContent??"";if(a===t.name&&l===t.position&&S===t.phone){let i=s.querySelector(f),u=s.querySelector(_),m=s.querySelector(L);i&&u&&m&&(i.textContent=o.name,u.textContent=o.position,m.textContent=o.phone)}})}function rt(t){let o=t.target;if(o.closest(x)){let e=o.closest(F);if(!e)return;let n=e.querySelector(g);if(!n)return;n.classList.toggle(P),n.classList.contains(P)?n.style.maxHeight=`${n.scrollHeight}px`:n.style.maxHeight="0"}}document.querySelector(q)?.addEventListener("click",t=>{let o=t.target;if(o.closest(D)){ot(t);return}if(o.closest(h)){let e=o.closest(C),n=e.querySelector(f)?.textContent??"",c=e.querySelector(_)?.textContent??"",r=e.querySelector(L)?.textContent??"";U({name:n,position:c,phone:r})}rt(t)});document.querySelector(q)?.addEventListener("keydown",t=>{let o=t;if(o.key===" "||o.key==="Enter"){t.preventDefault();let e=t.target;if(e.matches(D)){ot(t);return}if(e.closest(h)){let n=e.closest(C),c=n.querySelector(f)?.textContent??"",r=n.querySelector(_)?.textContent??"",s=n.querySelector(L)?.textContent??"";U({name:c,position:r,phone:s})}rt(t)}});var st=t=>t.key==="Escape";var E=document.querySelector(z),ct=document.querySelector(k);function at(t){E.showModal(),ct.style.overflow="hidden";let o=E.querySelector(Q);o.innerHTML="";let e=t.content.cloneNode(!0);o.appendChild(e),E.querySelector("input").focus(),document.addEventListener("keydown",R)}function B(){E.close(),ct.style.overflow="auto",document.removeEventListener("keydown",R)}function R(t){st(t)&&(t.preventDefault(),B())}var lt=t=>{let o="";t.addEventListener("input",()=>{let e=t.value.replace(/\D/g,"");if(e.length<o.length){o=e;return}e.length===1&&e[0]!=="7"&&(e=`7${e}`);let n="+7 ";e.length>1&&(n+=e.substring(1,4)),e.length>4&&(n+=` ${e.substring(4,7)}`),e.length>7&&(n+=` ${e.substring(7,9)}`),e.length>9&&(n+=` ${e.substring(9,11)}`),t.value=n,o=e})};var Et=3,ut="input--error";function Lt(t,o){t.forEach(e=>{e.classList.remove(ut)}),o.textContent=""}function mt(t,o,e){t.classList.add(ut),o.textContent=e}function dt(t){let o=[];return t.forEach(e=>{e.value.trim()||o.push({input:e,message:"Fill in all fields!"})}),o}function St(t,{name:o,position:e,phone:n}){return t.some(r=>r.name?.toLowerCase()===o.toLowerCase()&&r.position?.toLowerCase()===e.toLowerCase()&&r.phone===n)?[{input:null,message:"This contact has already been recorded!"}]:[]}function it(t,o){let e=[],n=/^[a-zA-Z]+$/;return t.value.length<o&&e.push({input:t,message:`Value cannot be shorter than ${o} letters!`}),n.test(t.value)||e.push({input:t,message:"Value must contain English letters!"}),e}function Ot(t){return/^\+7 \d{3} \d{3} \d{2} \d{2}$/.test(t.value)?[]:[{input:t,message:"Wrong number!"}]}function pt(t,o,e){let[n,c,r]=t;Lt(t,e);let s=dt(t);if(s.length>0)return{ok:!1,errors:s};let a={name:n.value,position:c.value,phone:r.value},l=St(o,a);if(l.length>0)return{ok:!1,errors:l};let S=it(n,Et);if(S.length>0)return{ok:!1,errors:S};let i=it(c,Et);if(i.length>0)return{ok:!1,errors:i};let u=Ot(r);return u.length>0?{ok:!1,errors:u}:{ok:!0,errors:[]}}var Tt=document.querySelector(K),O,M,T,p=null;function U(t){Tt&&at(Tt);let o=E.querySelector(Z);o&&(o.textContent="Edit contact"),p=t,O=E.querySelector(Y),M=E.querySelector(j),T=E.querySelector(J),O&&M&&T&&(O.value=t.name,M.value=t.position,T.value=t.phone),E.querySelector("input").focus(),document.addEventListener("keydown",R)}function Yt(){let t=O?.value.trim()??"",o=M?.value.trim()??"",e=T?.value??"";if(!p)return;let n=p.name,c=p.position,r=p.phone;if(!O||!M||!T)return;let s=[O,M,T],a=document.querySelector(W);T&&lt(T);let{ok:l,errors:S}=pt(s,N(),a);if(!l){S.forEach(({input:m,message:I})=>{m?mt(m,a,I):a.textContent=I});return}let i={name:n,position:c,phone:r},u={name:t,position:o,phone:e};if(et(i,u),nt(i,u),B(),p){let m=document.querySelector(`[data-id="${p.name[0].toUpperCase()}"]`)?.querySelector(C);if(m){let I=m.querySelector(h);I&&I.focus()}}p=null}export{U as openEditPopup,Yt as saveEditPopup};
